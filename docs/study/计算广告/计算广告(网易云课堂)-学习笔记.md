# 计算广告(网易云课堂)-学习笔记

> 计算广告2.0 从数据变现到用户增长
>
> *<small>如果需要阅读该笔记，最好下载到本地，挺多网络图片在github上加载不出来</small>*

# 1. 课程概述

## 1.1 课程知识点

课程主要讲解以下几类知识点：

+ 数据与商业化的全貌和发展历程
+ 主要商业化产品的需求与原理
+ 重要系统与算法挑战及解决方案
+ 应如何利用和运营各商业化产品
+ 各类岗位需要什么样的知识准备

课程不包含以下内容：

+ 相关基础学科的完备讲解
+ 具体某款产品的使用指南
+ 各技术方案的代码级实现
+ 工作中问题的系统答疑

# 2. 认识商业化体系

广大耳熟能详的互联网厂商，一半以上的收入来源于广告。

## 2.1 与商业化相关的产品问题

+ **商业模式探索**

  例如：电影是一种边际成本很低，同时信息传播量很大的典型商品。是否可能探索一种售价很低，而充分利用其信息传播能力的电影行业发行模式？

+ **流量变现**

  例如：互联网电视厂商除了销售收入，还可以获得用户流量。这些流量的性质如何，应如何变现？

+ **数据变现**

  例如：室内导航技术是近年来快速发展的新型互联网应用。这类产品会得到什么样有价值的数据资产，又应该采用哪种具体的商业产品来变现？

+ **用户增长**

  例如：电商网站如何判断各个流量来源的效果与归因关系？如何用数据来找到转化过程中的问题？

## 2.2 什么是免费模式？

+ 免费模式本质
  + 能够个性化传播信息的产品，售价都会趋向其**边际成本**
+ 免费模式举例
  + 网站、应用：边际成本≈0
  + 手机、电视：边际成本≈量产成本（举例：红米手机）
+ 免费模式目的
  + 获得其他资产，通过后向渠道变现

##  2.3 互联网三项可变现核心资产

+ 品牌

  根据用户熟悉的形象提高付费内容**关注程度**

+ 数据（对应个性化）

  根据用户偏好提高付费内容**投放效率**

+ 流量（对应规模）

  在正常（Organic）内容中夹带**付费（Sponsored）内容**

## 2.4 流量变现与数据变现

​	举例，原本网站摆放男士剃须刀广告，**流量价值**10000（从甲方盈利）；后面该网站通过流量分析，得知男士用户和女士用户数量相当，于是修改广告位摆放的广告，一方面摆放男士剃须刀广告，另一方面摆放女士护肤广告，一方面降低剃须刀公司甲方投放广告的所需费用，另一方面从另一个护肤品甲方获取盈利。

​	原本：从剃须刀甲方盈利1000 => 后来： 从剃须刀甲方盈利6000 + 从护肤品甲方盈利6000。

​	多出来的2000利润，来自**数据价值**（即网站原本对用户数据的分析，从而有后续的广告摆放改进，进而加大获利）

​	流量价值10000+数据价值2000 = 6000 + 6000 （流量+数据变现的成果）

## 2.5 品牌属性变现

+ 利用熟悉Logo进行再营销

  比如商品左边加个平台logo图标，引起用户关注（提高用户点击率）

+ 利用品牌形象带来高关注

  比如新品牌出现，请代言人加上一段词，然后理所当然地加上新品牌的图标，引起大众对新品牌的关注

## 2.6 关于商业化体系

+ 以广告为载体的商业化体系支撑了整个互联网行业的大半壁江山。不了解它，就不可能深入了解互联网。
+ 互联网商业化体系是迄今为止，大数据领域唯一形成规模化营收的应用。
+ 商业化是结合了计算技术、心理学、经济学、营销学等的综合应用。

## 2.7 iab.与其他行业协会

+ iab.（Interactive Advertising Burean）
  + 在线广告供给方的行业协会，推动数字化市场营销行业的发展
  + 指定市场效果衡量标准和在线广告创意的标准
  + 会员：Google，Yahoo，Microsoft，Facebook等

+ 4A（American Association of Advertising Agencies 
  + 主要的协议是关于广告代理费用的收取约定，避免恶意竞争
  + 主要集中在创意和客户服务，在线业务是一部分
  + 会员：Ogilvy & Mather，JWT，McCann等，Dentsu等非4A会员的大公司但也被列为4A公司
+ ANA（Association of National Advertisers）
  + 主要代表广告需求方的利益（也有媒体和代理会员）
  + 会员：AT & T，P & G，NBA等

# 3. 理解大数据问题：来源、问题与应用

## 3.1 数据来源

+ 交易数据
  1. 定义：业务流程中必须记录的数据
  2. 举例：
     + 电信：通话记录、话费等
     + 银行：存取款、利息等
     + 医疗：病例
  3. 特点：
     + 数据规模中等
     + 一致性要求极高
+ 行为数据
  1. 定义：业务流程中非必需记录的数据
  2. 举例：
     + 互联网：所有服务后台日志
     + 电信：通话内容、上网记录
     + 医疗：日常健康指标
  3. 特点：
     + 数据规模巨大
     + 一致性要求较低

## 3.2 数据应用

+ 洞察应用

  + 全局或局部性的统计信息获取

  + 举例：
    + 企业财务报表
    + 日常运营报表
  + 特点：
    + 主要用于宏观决策支持
    + 面向领导和运营人员

+ 自动化应用

  + 个体的行为和兴趣特征捕获
  + 举例：
    + 定向广告
    + 客户关系维护
  + 特点：
    + 主要用于微观业务实施
    + 面向机器和销售人员

## 3.3 关于BigData

+ 采样分析
  + 通过小部分数据即可相当准确地解决问题
  + 举例：
    + 用户教育程度分布统计
    + 人口普查
    + 百度迁徙地图
  + 特点：
    + 实际上不需要大规模计算
+ 全量加工
  + 必需分析全量数据才能解决问题
  + 举例：
    + 个性化推荐
    + 计算广告
    + 个人征信
  + 特点
    + 大规模计算无法避免

### 3.3.1 大数据保险行业展望

+ 自动化应用
  + 非理财险的利润来源于信息不对称！
  + 利润 = 保费 - 平均赔偿 * 出险率（客户对此变量无直觉）
  + 通过对于出险率的准确预测，可以极大地提高保险产品利润
+ 行为数据
  + 例1：汽车保险对上一年未出险人群打折
  + 例2：某地区某癌症发病率是平均水平三倍
+ 全量加工
  + 出险率预估 + 个性化定价

### 3.3.2 大数据医疗行业展望

+ 行为数据

  随着可穿戴设备及云存储的普及，个人健康数据规模将爆发增长

+ 自动化应用

  基于个人健康数据，实现个性化医疗和点对点医疗新模式

+ 洞察应用

  海量健康数据将催生数据驱动的医学研究方法

+ 全量加工

  个人健康建模+疾病的管理与预防

## 3.4 直观认识在线广告：目的与形式

### 3.4.1 目的

1. 品牌触达（Brand Awareness）

   创造独特良好的品牌形象，提升长时期内的**转化率**与**利润**

   举例：模特儿穿戴劳力士=>用户将“高贵、有格调”和劳力士手表关联，未来买手表可能选购劳力士。

2. 直接效果（Direct Response）

   有**短期内**明确用户**转化**行为诉求（过去10年互联网广告的精髓）

   举例：商品促销广告，临时打折活动

3. 同一客户不同目的的推广

---

**广告的根本目的**

+ 传统的视角
  + **广告的根本目的是广告主通过媒体达到低成本的用户接触**
  + 广告的投入产出比（Return on Investment，ROI）相比于销售人员的劝服活动应该较高
+ 互联网新视角：
  + **一切付费的信息、产品或服务的传播渠道，都是广告**
  + 直接效果广告的ROI应该可衡量、可优化

### 3.4.2 广告形式

1. 偏直接效果性广告形式
   + 条幅广告Banner（图片+文字）
   + 文字广告Textual（常见的急搜索引擎搜索结果的文字广告）
   + 邮箱营销Email Direct Marketing，EDM（国外盛行，国内无差别投放，基本都被当作垃圾邮件看待）
2. 偏品牌触达性广告形式
   + 视频广告video ad（常见的就是视频前中后内嵌商品广告）
   + 富媒体广告rich-media ad（早期博客时代，网页左右的视频横幅、动图广告等，现在少）
   + 开屏广告（常见的即手机应用打开时的大屏广告）

3. 移动广告普通形式

   + 条幅（和网页端相似，但是现在不受欢迎）
   + 开屏（就是应用打开时的广告）
   + 推荐墙（专门推荐一类信息的内容板块）
   + 信息流广告（比如浏览用户动态列表时，往下滑动几次后加载大小一致的信息流广告）

4. 激励性广告

   + 原生激励视频（比如手机游戏需要消耗体力值，体力值用完后，观看下方广告后可免费获得体力值）

   再比如有些应用里面会有什么小任务，要求用户安装某一个app，然后奖励多少积分or现金。这种虽然用户后续直接删掉对应app的可能性很大（用户后续质量较低），但是同样有价值。首先这类广告投放费用一般较低，再者甲方可能是为了刷榜，短时间内加大用户流量等目的。这类广告投放，一般出于直接效果（Direct Response）目的，而非品牌触达（Brand Awareness）效果。

5. 泛广告商业产品-团购

   常见的就是外卖app里的餐点服务

6. 泛广告商业产品-网址导航

   比如360、hao123等导航网站，会聚集大量的网址，这些网址的拥有者需要付费才能在导航页面的靠前位置显示。

7. 游戏联运

   常见的比如腾讯平台等，如果游戏制作人想要发布游戏，可能考虑这类大游戏平台，虽然利润分成可能最后平台拿走较多，但是能保证游戏正常获利，不至于腹死胎中。

# 4. 计算广告逻辑与挑战：六大算法问题

## 4.1 商业化体系大闭环

![img](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210616162516335-2013677402.png)

## 4.2 计算广告的核心挑战

+ 计算广告的核心问题，是为一系列用户与环境的组合，找到最合适的广告投放策略以优化整体广告活动的利润。

+ 优化问题描述：

  利润 = 收入 - 成本。下方图片中的第一行方程式即优化的目标（利润）。
  
  图片第二行方程式表示广告的计算限制。比如，k可以表示合同最多不能超过多少钱，或者合同最少要有多少次展示量

![img](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210616162759489-1981174793.png)

## 4.3 广告业务的转化漏斗与目标

**eCPM**

> [eCPM_百度百科 (baidu.com)](https://baike.baidu.com/item/eCPM/3461950?fr=aladdin)

​	ECPM（effective cost per mille）指的是每一千次展示可以获得的广告收入，展示的单位可以是[网页](https://baike.baidu.com/item/网页/99347)，广告单元，甚至是单个广告（在 [AdSense](https://baike.baidu.com/item/AdSense/215191) “高级报告”的“数据展示依据”下拉框中可以选择）。

​	默认情况下，eCPM 指的都是千次网页展示（Pageview）收入。eCPM 只是用来反映网站盈利能力的[参数](https://baike.baidu.com/item/参数/5934974)，不代表收入。

​	ECPM = 收入/网页展示次数×1000

+ 收入 = 广告单价×网页点击率×网页展示次数

+ 网页点击率×网页展示次数 = 网页点击数……

+ ECPM = 广告单价×网页点击率×1000

​	ECPM，它是一个与网页展示次数无关的指标，这证明一点：一个网站的AdSense可盈利趋势与网站的大小无关，它最终是由平均广告单价和广告的点击率决定的。

​	那么如何提高网页的eCPM，首先前提条件是网页需要有足够的流量和足够的点击，如果每天的点击数低于100，那么就没必要管什么eCPM了，先想办法提高网站流量再说，如果网站已经有了不错的流量，但是eCPM的数值偏低，我们可以在不违反Adsense的计划政策的前提下，通过以下几个方法来提高网站的eCPM。

<small>（具体的还是直接看百度百科即可，这里也就是把内容搬运过来）</small>

+ 提高网站的总体流量
+ 提高网站的点击率
+ 删除点击率低的广告
+ 库存收益管理下的eCPM解读

---

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617105420017-1426055656.png)
$$
eCPM = r(a,u,c) = μ（a,u,c) * v(a,u)
$$

+ `μ(a,u,c)`	表示点击率
+ `v(a,u)`	表示点击价值

上图的公式，a表示ad（广告），u表示user（用户），c表示content（内容）。

---

这里需要注意的即如何标识一个user（可能有多端问题）。

+ PC Web / Mobile Web环境

  Cookie：存续性差，跨域时需要映射

+ IOS应用

  IDFA：存续性好于cookie，但IOS10有更严格的政策（简言之就是用户不让你用就用不了）

+ Android应用

  Anddroid ID：存续性好于IDFA；IMEI：在中国有部分使用（但是外国不用）

+ 无以上ID场景

  FingerPrint（IP + User Agent）：存于http头中，可作缺省标识。（经常变动，最坏的情况使用）

理想方案即使用IDFA、Android或Cookie，FingerPrint是不得已而为之的方案。

## 4.4 商业化体系六大算法问题

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617111655904-637786244.png)

+ 特征提取：受众定向
+ 微观优化：eCPM估计
+ 宏观优化：机制设计
+ 受限优化：在线分配
+ 强化学习：探索与利用
+ 重定向：个性化推荐

## 4.5 用户决策的转化漏斗模型

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617133218091-594029212.png)

+ 选择（曝光exposure，关注attention）

+ 解释（理解comprehension，信息接受message acceptance）
+ 态度（保持retention，购买purchase）

---

常见的一些广告策略的效果

+ 幽默（引起关注，但是只有理解的人才会觉得幽默）
+ 性感（引起关注，但是并非所有人群都接受这类信息，可能引起反感）
+ 艺术（较难理解，但是容易给人留有持久的印象）
+ 折扣（引起人们关注和购买欲，但是需要一定的成本）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617134005576-1340907038.png)

## 4.6 在线广告主要结算方式详解

> [广告术语CPM、CPT、CPC、CPA、CPS，一次说清！ (sohu.com)](https://www.sohu.com/a/165317940_174744)	=>	推荐阅读，很详细
>
> [广告行业中常说的 CPC，CPM，CPD，CPT，CPA，CPS 等词的意思是什么? - 知乎 (zhihu.com)](https://www.zhihu.com/question/26506736)

<table>
  <tr align="center">
  	<th>结算方式</th>
    <th>点击率估计</th>
    <th>点击价值估计</th>
    <th>优缺点</th>
    <th>适用场景</th>
  </tr>
  <tr>
  	<td align="center">CPT</td>
    <td colspan="2" align="center">需求方</td>
    <td>1. 可以充分发挥橱窗效应。<br />2. 无法利用受众定向技术。</td>
    <td>高曝光的品牌广告</td>
  </tr>
  <tr>
  	<td align="center">CPM</td>
    <td colspan="2" align="center">需求方</td>
    <td>1. 可以利用受众定向选择目标人群。<br />2. 合约售卖下，受众划分不能过细。</td>
    <td>1. 有受众选择需求的品牌广告<br />2. 实时竞价广告交易</td>
  </tr>
  <tr>
  	<td align="center">CPC</td>
    <td align="center">供给方</td>
    <td align="center">需求方</td>
    <td>1. 可以非常精细地划分受众人群。<br />2. 比较合理的供给方和需求方分工。</td>
    <td>竞价广告网络</td>
  </tr>
  <tr>
  	<td align="center">CPS</td>
    <td colspan="2" align="center">供给方</td>
    <td>1. 需求方无任何风险。<br />2. 供给方运营难度较大。</td>
    <td>1. 效果类广告联盟<br />2. 效果类DSP</td>
  </tr>
</table>

视频中，说CPC是现在比较主流的方式（2016年的教程）

上表中，除了CPC，其他都是一头沉的模式，都需要第三方监控（比如百度浏览量统计等第三方平台）。

### 4.6.1 CPA/CPS的问题与合理场景

存在的问题：

+ 由供给方同时负责优化点击和转化率，并非普适的合理模式
+ 存在劫持、代销等多种相应的灰色手段
+ 用于优化的数据对于单个广告主来说严重不足

适用的场景：

+ 转化流程一致且规范的广告市场
+ 例：淘宝客（转化流程为淘宝统一提供）、APP下载（转化流程在Apple Store或Google Play）

---

教程视频中提到oCPM和CPA。（另一个oCPC类似，根据CPC收费，但是根据CPA优化）

oCPM是FaceBook提出的，根据CPM结算，**创新点在于不是根据CPM优化，而是根据CPA优化**。

oCPM根据广告主（甲方）的需求Action（比如下载），对广告进行优化，但是最后根据CPM方式收费。

这么做的好处如下：

+ 对广告主（甲方）的要求低。CPA可以吸引更多的广告主，资金要求相对较低，其他门槛低，广告主可以不参与广告优化
+ 广告平台方便控制风险。纯CPA优化，广告平台可能亏损，所以按照CPM收费，但是往CPA方向优化（相当于有个过渡CPM=>CPA）

​	**oCPM是为了向CPA过渡而产生的中间模式，本质还是为了优化A，但是通过CPM降低了风险，使这种模式能够规模化实现**。

> [oCPM功能以及原理简述 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/40814720)	=>	文章很棒，建议阅读
>
> 简言之，oCPM，一方面，使得甲方获得更高ROI；另一方面，使得乙方（广告平台）有动力优化广告，提高点击率、点击到转化的比例，使得平台的流量变现能力更强。

# 5. 商业化产品体系概览：六大产品问题

## 5.1 商业产品设计运营原则

+ 商业产品，即面向商业客户而非一般用户的产品，其中最典型的代表就是广告产品。
+ 相对于产品功能，要特别关注产品中的策略部分。
+ 要特别关注数据，让运营和产品优化形成闭环。所有产品特征和策略的成功与否，要严格根据数据的反馈来判断。
+ 优化的是确定的商业目标，而非使用便捷性。

## 5.2 数据驱动的商业产品发展历程

> [互联网商业变现之在线广告（1）：合约广告产品和竞价广告产品 (baidu.com)](https://baijiahao.baidu.com/s?id=1661307535434188973&wfr=spider&for=pc)
>
> 竞价广告和合约广告对比
>
> + 从供给方或广告市场方来看，合约广告和竞价广告的对比可以类比于计划经济和市场经济的区别。合约广告情况下，媒体要要保证量和质。而在竞价广告的情况下，市场只负责制定竞价和收费的规则，广告主量的保证采用市场竞争的方式来完成。
>
> + 从需求端来看，合约广告的采买方式对广告主来说缺乏透明性，无法确定媒体确实投放这么多量。不过，预先预定保证量的合约的采买方式这对于品牌性质较强的广告活动来说比较有意义的。在竞价广告中，供给方不再向广告主承诺广告投放量，且交易逻辑由首先确保量的结构变成了首先确保单位成本的结构。

+ 竞价的模式，使得我们能够把精细的数据利用起来，**竞价是整个商业广告产品发展历程中最重要的里程碑，意义远远超过程序化广告和原生广告**。

+ 程序化交易，是为了变现第一方数据和第三方数据。
  + 第一方数据：广告主自己的数据
  + 第三方数据：和广告主、媒体无关的其他数据。这类数据需要程序化的框架中才能利用起来。
+ 场景数据是现在关注的一个热点，过去PC时代没有这个说法，现在移动端应用可以包揽衣食住行等多方面，才催生出这一概念。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617154003109-1060649243.png)

## 5.3 商业化体系六大产品问题

+ 供需接口
+ 竞价机制
+ 数据运营
+ 标签体系
+ 程序化交易
+ 原生广告

### 5.3.1 供需接口

**需求方层级组织**

+ **广告活动（Campaign）**概念上对应于广告主的一次投放合同，其中包括了预算、时间范围等基本信息。
+ **广告组（Ad Group）**对应于一个具体的广告投放策略，主要是设定受众定向条件和出价。
+ **广告创意（Creative）**则是最终展示出来的素材，可能在同一个组策略下有不同尺寸的创意存在。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617160820889-1107916105.png)

---

**广告计划、广告组设置示意**

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617160859361-43819347.png)

---

**媒体、广告位设置示意**

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617161434679-2061353300.png)

---

**供需之间的各种对接方式**

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617161602963-1249719389.png)

+ SDK（别人在媒体中嵌入内容，需求方控制能力更高）
+ API（不让别人嵌入，隔一段时间从API那里拉取广告，自己做抉择，供给方从需求方那边的API拉取广告库数据，进行展示）
+ RTB（每一次广告展示，都请求一次广告，<u>程序化交易方式</u>）
+ 投放界面（UI投放，即需求方填写制定的参数，媒体根据参数投放广告。API则需要需求方封装对应的代码）

**RTB每次供给方向需求方发起请求时，需求方直接给出对应的广告，供给方直接展示对应的广告即可；而API，供给方向需求方请求后获取到的是一个广告库，供给方需要再自己做决策展示哪些广告。**

# 6. 商业化产品系统框架：六大系统技术

## 6.1 个性化系统一般框架

+ 在线投放引擎：要求高并发、低延迟

+ 数据高速公路：吞吐量要求高，但是容错性、数据一致性要求不严格（少数数据错误可以容忍）

+ 流计算平台：常见的storm、spark、flink等
+ 分布式计算平台：hadoop、spark等

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617163459461-1971989790.png)

## 6.2 Web-scale技术问题比较

<table>
  <tr align="center">
  	<th></th>
		<th>搜索</th>
    <th>搜索广告</th>
    <th>显示广告</th>
    <th>个性化推荐</th>
  </tr>
  <tr align="center">
  	<td>主要准则</td>
    <td>相关性</td>
    <td colspan="2">利润</td>
    <td>用户兴趣</td>
  </tr>
  <tr align="center">
  	<td>其他目标</td>
    <td>垂直领域决定</td>
    <td colspan="2">质量、安全性</td>
    <td>多样性、新鲜度</td>
  </tr>
  <tr align="center">
  	<td>索引规模</td>
    <td>十亿级</td>
    <td>百万 千万级</td>
    <td>百万级</td>
    <td>百万级 亿级</td>
  </tr>
  <tr align="center">
  	<td>个性化</td>
    <td colspan="2">较少的个性化需求</td>
    <td colspan="2">亿级规模用户上的个性化</td>
  </tr>
  <tr align="center">
  	<td>检索信号</td>
    <td colspan="2">较明确</td>
    <td colspan="2">较分散</td>
  </tr>
  <tr align="center">
  	<td>Downstream优化</td>
    <td colspan="3">不适用</td>
    <td>适用</td>
  </tr>
</table>

## 6.3 广告系统的特点

+ 高并发、低延迟的要求

  同时关注QPS和Latency

+ 数据处理的规模很大

  （用户、环境、信息）三元组上的数据建模

+ **数据处理的速度优先于精度**

+ **主流程的一致性要求不高**

## 6.4 广告系统的设计原则

+ 建立弱一致性的设计思维方式

  例：Near-line page fetcher

+ 大量数据尽量环形单项流动

  避免集中读写形成的单点性能瓶颈

+ 在线时不要发生与关系型数据库的交互

  增删改查的传统需求实际上不存在（往往就是批量写和随机读）

+ 充分利用开源社区的成熟技术

## 6.5 开源软件的优势与顾虑

优势：

+ 大量细分适用场景都有开源方案
+ 大型互联网公司的开源产品经过充分测试

顾虑：

+ 需要仔细甄别好的和不太好的开源项目
+ 在遇到深层次bug时无能为力

**核心业务逻辑不应选择开源**（广告中的核心逻辑：广告检索、排序算法）

## 6.6 商业化产品系统架构统一框架

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617190410043-939185288.png)

## 6.7 商业化系统的开源架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617190659728-1710179634.png)

## 6.8 商业化产品系统架构分解

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617191224834-323006611.png)

**在线计费：预算控制**

**离线计费：最后财务结算的标准**

在线计费使用的反作弊方法比较简单，离线计费使用更复杂的策略，最后计算结果不同。

## 6.9 商业化产品六大系统技术

+ 流量接入：代码和SDK
+ 投放引擎：高并发服务
+ 候选查询：实时索引
+ 特征存储：No-sql数据库
+ 离线学习：分布式计算
+ 在线学习：流式计算

## 6.10 主要广告产品优化目标分解

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210617191545711-330506433.png)

# 7. 最优化 Optimization

> 推荐书籍：
>
> + 凸优化 Convex Optimization
> + 数值优化 Numerical Optimization
>
> 数值优化这本书偏工程性，有很多伪代码。

## 7.1 什么是最优化问题

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619133904820-2126017496.png)

## 7.2 无约束优化问题一般思路

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619134103436-1734287479.png)

批处理模式，需要计算所有样本，需要多台机器并行计算以减少计算时间，实际应用很少。

串行模式，取部分随机样本，计算梯度，整体的收敛性也不错，现代数值优化中常用的方法。

### 7.2.1 批处理梯度法的问题与拟牛顿法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619134647360-334378554.png)

批处理梯度法，收敛性差。

### 7.2.2 BFGS和L-BFGS方法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619135028359-972945804.png)

### 7.2.3 思路梳理

+ 目标函数不可导，则考虑7.1.1中的下降单纯形法（Ameoba变形虫法）

+ 目标函数可导，考虑7.1.1中的梯度下降法
  + 串行模式，随机梯度下降法是比较好用的，可随时使用
  + 批处理梯度法，一般不运作，因为存在7.1.2 提到的zigzag问题（为解决该问题出现牛顿法=>但是该方法仍然有问题，后续出现别的解决方法，拟牛顿法）
    + BFGS和L-BFGS是常见的拟牛顿法，其中L-BFGS解决大量自变量情况下Hession矩阵过大的问题。

### 7.2.4 Trust-region方法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619140102943-200785498.png)

Trust-region方法，实际应用也挺多。

+ **牛顿法是先定方向，后定步长**
+ **Trust-region是先定步长，后定方向**

## 7.3 带约束优化：拉格朗日法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619140440401-1137380535.png)

​	实际工程思路，碰到带约束优化问题，先用拉格朗日法把问题转化为无约束优化问题，无约束优化问题，再套用前面提及的解决方案。

# 8. 信息检索Information Retrieval

## 8.1 文档的表示与相似度量

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619141726560-1954298143.png)

## 8.2 倒排索引

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619142150854-1611496106.png)

# 9. 统计机器学习Statistical Machine Learning

## 9.1 贝叶斯学习

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619142746451-1344393382.png)

贝叶斯的核心精髓，所有的参数都是不确定的，都是只能估计分布，带着分布计算

## 9.2 指数族分布（一）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619144840831-2061818124.png)

实际工程中，用到的统计相关的机器学习模型，往往是用指数族分布。

## 9.3 指数族分布（二）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619145611261-1676356974.png)

**指数族分布的最大自然估计，只要走一遍数据就可以计算出来。**

**走一遍数据得到充分统计量，根据充分统计量，解出最大自然估计。只有指数族分布有这种特点。**

## 9.4 指数族贝叶斯学习

> 视频中的指数族分布的知识，主要是点到为止，想知道更多，教程建议看PRML《模式识别与机器学习》这本书，说里面描述很透彻。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619145223363-926645203.png)

前面提到的指数族分布，都是单峰问题，多峰问题，需要用EM算法解。

## 9.5 指数族分布map/reduce学习框架

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619150419996-391802141.png)

# 10. 深度学习Deep Learning

## 10.1 深度学习是什么

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619151044893-909849696.png)

过去人工设计特征，就需要各领域的专家参与制作，程序大而重。

深度学习，GPU计算快，自动提取特征，不需要专家参与。深度学习的模式，表示能力更强。

现在语音识别、计算机视觉上，普遍应用深度学习。

## 10.2 全连接多层感知机(Multi-layer Perceptron，MLP)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619151925664-166817859.png)

这里参数不共享，每个神经元的加权系数，都是单独计算的，参数量很大。

这个用得并不多。

## 10.3 深度学习的工程本质

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619152225346-1993316742.png)

深的模型，比浅的模型表示能力强。

深度学习模型，很早就有了，只不过没有好的优化方法，后来出现了GPU计算方法，才在近几年爆火。

打比方，原来的model，10W数量级数据就能运作，而现在的model，100W数据后还能承受，且实际识别能力更好。换句话说，deep learning的模型，往往需要大量的数据才能运作。

## 10.4 卷积神经网络(Convolutional NN)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619153124310-2145066982.png)

卷积神经网络最核心的一个思路，在整个tensor里面不同的位置，共享一个同样的卷积核，使得问题的参数数量大大下降，稳定可解。

基本上图像处理的问题，都使用卷积神经网络。

## 10.5 递归神经网络(Recurrent NN)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619154112926-1153496690.png)

## 10.6 Long-Short Term Memory(LSTM)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619154302200-1445626347.png)

## 10.7 Generative Adversarial Network (GAN)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619154747362-799718880.png)

前面的神经网络都是解决鉴别的问题。（即给一张人脸，判断是不是人脸）

现在通过G生成一个人脸，然后希望原本的D鉴别结果当作是人脸，然后让D目标就是鉴别出G生成的假人脸。两者互相对抗，使得D的鉴别能力越来越强，G生成的人脸也能越来越像。

用途：

+ 如果G能生成很相似的数据，那么之后就能用来做无监督学习。

+ 比如画一个猫的轮廓，剩下的部分让G自动补全。

## 10.8 深度学习优化基础设施

+ CPU方案
  + 并行渲染屏幕上每个像素点，与并行计算各神经元很相似
  + 与CPU方案相比，可加速数倍乃是十数倍
+ 并行计算方法
  + SGD过程可以分解到多台机器上进行，分别更新参数
  + 可以采用parameter server的计算框架，水平扩展性强
+ 开源框架
  + Tensorflow、Caffe、Mxnet，可以一定程度上忽略硬件

# 11. 数据运营三板斧-用户增长

## 11.1 用户增长的基础：用户转化漏斗

用户转化漏斗示例

移动用户获取：

下载	=>	激活	=>	留存	=>	时长

电商用户转化：

到达商品页	=>	加入购物车	=>	完成订单	=>	交易确认

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619160418970-1326090488.png)

转化漏斗画出来后，还要有对应的监测工具，每一个点击、每一个留存事件都需要记录。

### 11.1.1 漏斗设计的原则与作用

原则：整个漏斗过程用于优化一个唯一的目标

作用：将目标分解为若干比率的乘积，便于发现问题并优化

示例：总用户时长=下载量\*激活率\*存活率\*平均用户时长

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619160914249-1073806703.png)

### 11.1.2 转化漏斗相关常见度量

+ 转化率

  激活数与点击数的比

+ {次日/七日/月}留存率

  某日激活的用户中，{次日/七日/月}后活跃的用户占比

+ {日/月}活跃用户(DAU，MAU)

  每{日/月}活跃的独立用户数

+ 用户时长

  每个活跃用户平均消耗的时间

## 11.2 找到增长的障碍：多维度报表分析

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619161634747-775210590.png)

漏斗的作用，发现注册率偏低，使得整体的转换效率偏低。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619161805310-1711578503.png)

在多维度报表中，发现是chrome浏览器的用户注册率低，那么就考虑是不是对应的页面代码兼容性问题或其他问题。

先从漏斗看出哪个环节出现问题，然后利用工具把某些数值打散到具体的多个维度上，这样就更容易找到问题所在。运营除了打点日志、基本的分析系统以外，还需要有多维度、灵活的报表。

### 11.2.1 数据魔方Data Cube

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619162247981-394834764.png)

+ 什么是数据魔方
  + 用户可以较灵活选择纬度组合，得到定制化报表
  + 为**人工决策**提供便利

+ 技术方案
  + **OLAP**数据库

+ 开源方案
  + **Saiku** + MySQL

## 11.3 驱动新产品特征：利用A/B测试

### 11.3.1 为什么需要A/B测试

> 一般需要保证除了测试参数外的其他参数一致。

+ 多维情况下，魔方里大部分区域数据非常稀疏
  + 极端情形：对于新Feature，需要主动分配测试流量
+ 某维度上的两个选项（例如两个不同的模型），数据并不是完全可比

+ 因此，我们需要一个主动的A/B测试框架，以便
  + **主动分配流量**给新的产品特征
  + 保证对比实验的各组在**数据上完全可比**
  + 尽可能在同样的流量规模上**容纳更多的实验**

> 分层测试框架，对于互相不相干的参数，放到不同的实验层，比如第一个参数是排序和检索各做一个实验，排序和检索相互独立，排序层分出1%流量随机分做实验，检索层使用hash函数再随机分出1%流量做实验。这样分的层数很多，假设每层20个实验，2层就有400个实验，3层就是8000个实验。

### 11.3.2 A/B测试并不是万能的

+ 用户产品过于依赖数据会丧失对**关键创新**的把握
  + 汽车无法从"跑得更快的马"进化而来（例：Zynga）

+ 多数情况下，需要测试的**可行组合太多**，必须先经过人的筛选，或更复杂的E&E策略
  + 例：每天数十万的新闻，哪些有可能最受用户欢迎
+ **博弈性场景**无法通过A/B测试获得可靠结论
+ A/B测试最适合的场景：
  + **理性**产品、**被动**反应场景

## 11.4 小结

任何一个产品要有一个完善的运营体系，需要三步骤：

1. 建立用户漏斗，搭建监控日志
2. 做一个Data Cube数据魔方
3. A/B测试框架

# 12. 用户属性变现-合约广告

## 12.1 广告位与展示量合约

### 12.1.1 广告位(CPT)合约

+ 与线下广告交易类似的传统模式
+ 供给方产品：广告排期系统
  + 帮助媒体自动执行多个合同的排期
  + 广告没有复杂的动态决策，因此可以将素材直接插入页面
+ 流量选择的维度
  + 时间段、地域、轮播
+ 典型场景
  + 高曝光广告位，开屏广告，应用市场头部位置，导航网址

### 12.1.2 展示量合约与担保式投送

+ 展示量合约
  + 基于合约的广告机制，有时未完成约定量要向广告商补偿
  + 多采用千次展示付费（Cost per Mille，CPM）方式结算
+ 但保式投送（Guaranteed Delivery，GD）引擎
  + CPM方式要求广告投送由服务器端完成决策
  + 三大技术基础：受众定向、流量预测、在线分配
+ 典型场景
  + 视频广告、富媒体广告、品牌条幅广告

> [Gd（广告术语）_百度百科 (baidu.com)](https://baike.baidu.com/item/Gd/19824035?fr=aladdin)
>
> Gd，是一种广告术语，指担保式保量投放。
>
> GD=Guaranteed delivery：担保式保量投放，也就是说广告主在投放广告时已经向媒体确认投放一定量广告，并且媒体已经确认会播放这些广告，并且在广告投放前已经约定好广告的价格和投放量。

### 12.1.3 广告位合约vs展示量合约

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619201848500-1488327148.png)

左边的广告位合约并不会因为展示的广告更多就能收取更多的广告费。

右边展示量合约，可以按照受众人群定向分配，不同人分配到不同的广告。

### 12.1.4 如何高效混合静态与动态广告

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619202234486-210618549.png)

​	如果从CDN上请求到的资源是CPT广告（假设资源上有标识可以判断），那么直接展示；如果不是CPT广告，就向广告服务器请求广告资源，如果返回其他动态广告，则直接展示动态广告，如果因为服务器宕机或其他原因出错，那么将CDN上获取的广告直接展示（保底措施，避免前端广告位闲置）。

## 12.2 多个合约如何满足：在线分配问题

### 12.2.1 展示量合约流量分配模型

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619202926714-640205714.png)

同一个供给节点可能满足多个需求节点，具体分配给哪个合约就是在线分配问题了。

### 12.2.2 流量预测

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619203855415-1054537500.png)

流量预测，实际上就是一个流量统计的过程。

**流量预测，是一个对供给节点进行倒排索引和查询的过程**。

### 12.2.3 在线分配问题框架

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619204402757-1011067591.png)

### 12.2.4 在线分配典型问题

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619204643634-121180582.png)

### 12.2.5 基于对偶算法的紧凑分配方案

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619205011181-901455753.png)

### 12.2.6 启发式的High Water Mark算法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619205139704-319706413.png)

**实际工程中用的较多的方案是启发式算法，其中常用的有High Water Mark算法**。

举例：第一个40%概率投放，第二个30%，第三个10%投放，最后都按照概率随机投放广告，各个server节点之间就不需要通讯了，互相**解耦合**。

（不是单纯的按照优先级，先投放第一个节点的再投放第二个的，这种的话每个节点之间需要同步信息）

## 12.3 担保式投送系统架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619205842800-470131415.png)

## 12.4 Yahoo！展示广告市场

+ 核心业务
  + GD，无法分配的流量转接到NGD（non-guaranteed delivery，即Rightmedia exchange）进行变现
  + GD市场广告主数量为几千，年收入为Billion量级
+ 其他点评
  + 采用compact allocation plan完成线上决策
  + 提供地域、人口属性、行为定向（常用的仅有几十个标签）
  + 合约式销售中，品牌广告主对曝光有独占要求

# 13. 高并发的广告系统：在线投放引擎

## 13.1 在线投放引擎

多台服务的上下线，一般用zookeeper。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619220737014-1285248024.png)

### 13.1.1 Nginx

Nginx

+ 轻量级Web服务器/反向代理服务器
  + 专为性能优化而开发，可支持数万并发
  + 内存和CPU占用较少
+ Nginx+FastCGI
  + 将主要业务逻辑在FastCGI中用C语言实现
+ 其他产品选择：Apache

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619220841983-2105761917.png)

广告的特点，就是并发特别高，Nginx基本就是广告业务的标配了。

### 13.1.2 Zookeeper

+ 解决分布式应用中的一些数据管理问题

  + 集群管理、分布式应用配置项的管理等
  + 理论基础是著名的Paxos算法

+ 集群管理

  + 将宕机、网络断链、新机器加入等迅速通知每台Server并重新分配流量

  + 用Zookeeper的Watch机制很容易实现

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619221238535-1639605522.png)

### 13.1.3 频次控制

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619221638126-1995851374.png)

存储频次时，不需要处理哈希冲突。因为哈希冲突的频率很低，对业务不会有太大影响，要是处理冲突了反而要引入很多额外计算。

采取弱一致性方案。

CPM广告里面，频次控制很重要；但是在CPC或者CPA广告里，偏效果类的广告里，往往会采取一些智能频次控制方法。

比如：传统理论认为频次在3之前爬坡，之后效果下降。实际是第一次最好，之后效果越来越差。

<u>讲师提到，应该把频次当作点击率预估的一个特征，动态地决策eCPM，采用竞价的方式实现，而非硬性限制频次。（但是这些广告主不会接受，还是会有硬性的频次要求）</u>

### 13.1.4 实验框架(Experimentation Framework)

+ 哪些场景需要线上A/B测试？
  + 广告系统的升级
  + 广告算法的改进
  + 创意或定向策略的优化
+ 实验框架的设计原则
  + 任何一组对比实验，其他的条件都应该相同
  + 线上流量容纳尽可能多的实验

### 13.1.5 分层实验框架

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210619235302822-1694180112.png)

需要根据实际业务分层。

# 14. 用户画像及其他：受众定向基本概念

## 14.1 受众定向方法分类

+ 受众定向即为（a，u，c）打标签的过程
  + 上下文标签可以认为是即时受众标签
+ 标签的两大主要作用
  + 建立面向广告主的流量售卖体系（标签需要有可解释性、可监视性）
  + 为各估计模块（如CTR预测）提供特征（实用主义，只提取建模需要的特征）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620193953306-1035708168.png)

## 14.2 常见受众定向方式

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620194901839-293983203.png)

### 14.2.1 常见受众定向方式(一)

+ 地域定向（Geo-targeting）
+ 人口属性定向（Demographical targeting）
  + 年龄、性别、教育程度、收入水平
  + 可监测，难获得，对效果意义有限
+ 频道定向（Channel targeting）
+ 精确位置定向（Hyper-local Targeting）
  + 利用蜂窝信息或者GPS获得精准位置，适用于O2O广告主
+ 上下文定向、行为定向

---

+ 地域定向（Geo-targeting）是所有定向广告的刚需，比如商品送货范围就只有上海。
+ 人口属性定向（Demographical targeting）是传统思路惯性的延续，没有什么道理，不见得这些指标一定有效，但是好处就是可监测。除了化妆品以外，大多数产品男女比例差异不大。
+ 频道定向（Channel targeting），比如体育频道，新闻频道等，但是仍站在媒体的角度，而非广告主的角度，效果一般。
+ 精确位置定向（Hyper-local Targeting），比如精确到某个小区附近，移动端应用较多。O2O广告特别适合咖啡、儿童教育等。儿童教育，因为小孩子需要精准定位，如果太远，家长不会同意。

> [o2o式营销_百度百科 (baidu.com)](https://baike.baidu.com/item/o2o式营销/15647611?fr=aladdin)
>
> ​	[O2O营销模式](https://baike.baidu.com/item/O2O营销模式/639034)又称离线商务模式，是指线上营销线上购买带动线下经营和线下消费。O2O通过打折、提供信息、服务预订等方式，把线下商店的消息推送给互联网用户，从而将他们转换为自己的线下客户，这就特别适合必须到店消费的商品和服务，比如餐饮、健身、看电影和演出、美容美发、摄影等。
>
> 　从表面上看，O2O的关键似乎是网络上的信息发布，因为只有互联网才能把商家信息传播得更快，更远，更广，可以瞬间聚集强大的消费能力。但实际上，O2O的核心在于在线支付，一旦没有在线支付功能，O2O中的online不过是替他人做嫁衣罢了。就拿团购而言，如果没有能力提供在线支付，仅凭网购后的自家统计结果去和商家要钱，结果双方无法就实际购买的人数达成精确的统一而陷入纠纷。
> 　　在线支付不仅是支付本身的完成，是某次消费得以最终形成的唯一标志，更是消费数据唯一可靠的考核标准。尤其是对提供online服务的互联网专业公司而言，只有用户在线上完成支付，自身才可能从中获得效益，从而把准确的消费需求信息传递给offline的商业伙伴。无论B2C，还是C2C，均是在实现消费者能够在线支付后，才形成了完整的商业形态。而在以提供服务性消费为主，且不以广告收入为盈利模式的O2O中，在线支付更是举足轻重。

### 14.2.2 常见受众定向方式(二)

+ 重定向（Retargeting）
  + 针对广告主老用户或相关用户进行再营销，属于定制化用户标签
  + 主要利用第一方数据
+ 新客推荐（Look-alike）
  + 根据对广告主提供的种子用户，为其找到相关的新客
  + 同时利用第一方和第二方数据
+ 动态定价（Dynamic pricing）
  + 并不是一种广告定向技术，但对价格敏感人群有筛选作用

---

+ 重定向（Retargeting），其中，"定制化"，某个广告主特定的标签，不是通用标签。比如“财经”、“体育”、“男女”属于通用标签，与广告主无关。“京东的老用户”，这个标签就只属于京东，与广告主相关，所以需要用到第一方数据。
+ 新客推荐（Look-alike），和重定向类似，但是需要根据广告主提供的种子用户为条件，找到新客。

## 14.3 受众定向标签体系

+ 结构化标签体系
  + 按照某分类法（Taxonomy）指定一个层次标签体系，父节点与子节点在人群覆盖上是包含关系。
  + 主要用于面向品牌广告的受众定向，特别常用于GD系统中。
+ 非结构化标签体系
  + 根据某类定向需求设置标签，标签并不能为同一个分类体系中所描述
  + 适用于多种目标、特别是效果目标并存的广告主的精准流量选择要求
+ 关键词
  + 按照搜索或浏览内容的关键词划分人群
  + 非结构化，容易理解，但操作和优化不容易

---

+ 结构化标签体系，建立一个树，新人产品经理一般都能想到。

## 14.4 标签体系一般设计思路

+ 分行业制定标签体系
  + 掌握各行业**用户决策逻辑**，依此制定标签体系
  + 不必拘泥于完备的分类法（Ontology）
+ 行业化标签体系举例
  + 汽车行业：价格 => 车型 => 品牌
  + 电商行业：单品、单品、单品！
  + 游戏行业：对每款游戏拓展竞品
  + 母婴行业：孩子的年龄

---

+ 汽车，价格一般最为重要，再来就是家庭结构导致的车型选择，最后才是品牌。
+ 游戏，一般很难找到标签体系，游戏很复杂，玩家容易变动玩游戏的类别，一般不会太固定只玩某类游戏。

+ 电商，一般只会对某个特定产品感兴趣，别的同类商品不感兴趣，所以直接单品推荐，一个单品就是一个标签。
+ 母婴，母亲根据孩子的年龄购买对应产品即可，什么年龄吃什么，玩什么，上什么班。

产品经理需要深入了解当前行业中影响用户决策的因素。

## 14.5 受众定向与用户画像

受众定向：

+ 强调**根据需求**找到相应的用户
+ 重点是**可优化**而非可验证
+ 例：某运动鞋的目标受众、某游戏的高付费人群

用户画像：

+ 强调获得用户固有的**可解释属性**
+ 在一定程度上**可验证**
+ 例：人口属性、生活方式、职业特征、收入状况

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620224742330-917160103.png)

### 14.5.1 YAHOO！的GD受众定向标签

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620225638076-2135931254.png)

### 14.5.2 bluekai的受众定向标签

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620225820142-1704426182.png)

相对Yahoo的，结构化更弱，非结构化标签。

---

+ B2B：比如IT企业找贩卖服务器的企业购买服务器。

# 15. 用内容解读任务：上下文定向

## 15.1 上下文定向原理

+ 根据用户正在浏览的页面和其他信息投送广告

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620230359636-371917229.png)

## 15.2 上下文定向主要方式

+ 举例

  + 地域定向、频道/URL定向，页面内容定向

+ 常用方法

  1. 用规则将页面归类到一些频道或主题分类

  2. 提取页面中的关键词（最常用，有爬虫即可实现）

  3. 提取页面入链锚文本中的关键词（即针对指向当前文章的文章进行分析，往往需要有全网的爬虫，非搜索引擎提供商就不好做）

  4. 提取页面流量来源中的搜索关键词（需要有用户行为日志）

  5. 用主题模型将页面面内容映射到语义空间的一组主题上

  除了1、2、5这3种，其他2种都需要其他特殊条件才能实现。

## 15.3 半在线(Near-line)抓取系统

+ 用在线cache系统存储url->特征表以提供实时访问
+ 不预先加载任何cache内容，对cache中不存在的url，立即返回空特征，同时触发相应的页面爬虫和特征提取
+ 设置cache系统合适的失效时间以完成特征自动更新

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620231156389-977064955.png)

---

用户第一次访问a页面，在缓存中，那么直接返回对应的关键词、主题，然后根据这些属性推送广告；

用户第一次访问页面d，不在缓存中，返回空特征，直接随机投放一个广告，并且系统这次去爬d页面并提取特征。

下一个用户访问页面d，由于上次爬取页面d并且提取了对应的特征，所以直接返回缓存中的关键词、主题，然后根据这些属性投放广告。

---

这样比起直接爬取所有网站更可行，极大程度减小了爬虫的成本，响应速度也不差。

---

<u>上下文定向和行为定向不一样，上下文定向根据半在线(Near-line)抓取系统实现，而行为定向完全是离线计算的。</u>

# 16. 将内容变成概念：文本主题模型

## 16.1 文本主题模型概要

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620232756206-112307397.png)

## 16.2 常用文本主题模型(一)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620233003718-40812893.png)

## 16.3 常用文本主题模型(二)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620233208629-1928359033.png)

LDA一路成为文本主题模型里的一个标配。

LDA加了超参数，起到平滑的作用，如果文本长短不一，或者噪声很大，特别是从互联网社交网络上得到的乱七八糟的文本，那么效果可能会更好一些。只能说LDA在某些情况下会更好。

---

+ LSA对文档矩阵进行奇异值分解
+ PLSI把其变成一个概率化的模型，可解释性强，能用EM算法更新迭代。
+ LDA把PLSI模型进行一个贝叶斯版本的处理，使其能处理更多的噪音环境下的文本，但是更难解。

## 16.4 词嵌入模型

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620233828201-950751372.png)

神经网络模型。与前面的LSA、PLSI、LDA的主要差别是，**词嵌入模型考虑了词的词序关系**。

一种是根据当前词预测后面的词，还有就是根据当前词预测前面的词。

这里比较妙的就是output输出进行哈夫曼树优化，从原本的时间复杂度，从O(N)优化到O(logN)，使得问题可解。

# 17. 用数据理解用户：行为定向

+ 根据用户历史上网记录和其他数据计算出用户兴趣，根据此投放广告

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210620234338015-603094189.png)

和上下文定向类似。

+ 上下文定向根据**即时兴趣**投放广告
+ 行为定向根据**历史兴趣**投放广告。

**行为定向的标签体系和上下文定向的标签体系是一样的。**产品逻辑一致，只不过技术过程不一样。

给用户投放广告的时候，不需要区分行为定向或者上下文定向，只需要区分人群。

## 17.1 行为定向数据来源(一)

+ 决策行为
  + 转化（Conversion）、预转化（Pre-conversion）
  + 对应着非常明确的用户兴趣，价值最高
+ 主动行为
  + 搜索（Search）、广告点击（Ad click）、搜索点击（Search click）
  + 在明确一度支配下主动产生的行为，价值也很高
+ 半主动行为
  + 分享（Share）、网页浏览（Page View）
  + 量最大，用户意图较弱，但也有一定价值

---

数据价值：决策行为 > 主动行为 > 半主动行为 > 被动行为

## 17.2 行为定向数据来源(二)

+ 被动行为
  + 广告浏览（Ad View）
  + 负面的加权因素
+ 用户ID
  + 最重要的数据，一串0前面的那个1
  + 稳定、精确的用户ID能大幅提高行为数据使用效率
+ 社交关系
  + 可以用与用户兴趣的平滑：当某个人的行为不足，无法进行精准的行为定向时，可以考虑借鉴其社交网络朋友的行为和兴趣。

---

数据价值：决策行为 > 主动行为 > 半主动行为 > 被动行为

用户ID、社交关系另外讨论。

## 17.3 各类行为的标签化方法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621141409711-1323568022.png)

搜索，这个有个技巧，就是利用成熟的电商接口。

一般我们会想到用自然语言处理等处理用户输入的内容，但是这样实现难，效果也不一定好。

比如输入“海尔冰箱”，我们可以利用成熟的电商的接口，获取最后获取到的单品对应的分类结果记录下来，这样就等于利用电商接口帮我们实现了标签分类。

但是这种利用电商接口的途径，有个前提，就是当前系统的标签体系需要和借鉴的电商的标签体系一致，不然就没有意义。（如果刚起步做电商平台就可以考虑这种方式）

同理，旅游的平台，可以借鉴当前耳熟能详的大平台。其他的同理，先通过现有大平台的接口完善功能，以后有能力后在自己做。

需要人工标注的情况是少数，比如上图中的广告，一般只有在广告是纯图片形式时，才需要人工设置标签。

## 17.4 行为定向建模

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621143849161-242762091.png)

h指一次点击行为。

广告点击可以算一个特征选择函数，网页浏览也可以算一个，不同的channel算不同的特征

t指某一个标签，比如“汽车类”、“体育类”

n表示重要程度，“浏览”、“点击”的重要程度不一样

## 17.5 行为定向特征选择过程

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621144554648-138084247.png)

上面比如最后某人在教育得3分，旅游得10分，体育得5分，那么最后归类到旅游类别中。

## 17.6 行为定向数据组织

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621144832607-119944778.png)

一般推荐使用"时间衰减方式"，因为滑动窗口方式每次都需要访问前一段时间的数据，而时间衰减只需要访问昨天和今天两份数据，计算效率较高。

## 17.7 受众定向评测 - Reach/CTR曲线

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621145146382-902992529.png)

这里说前面17.5中显然归类的门槛越低，归到某一类的概率就越高。比如归到旅游类的门槛是5分，那么可能有1000人归类进去，但是如果门槛是8分，那么可能只有100人归类到旅游类。

+ reach，目标人群占总人群的比例（极端例子，如果门槛设置为0，那么应该100%人都归在这一类中）

  上图左上角对应高门槛，右下角对应低门槛。

+ CTR是点击率，同一reach下，CTR越高越好。

该曲线图，左边越高，说明受众定向效果越好。

**该曲线图一般用于排查意外情况**。比如做完测试，绘制Reach/CTR曲线结果不是左上到右下的一条曲线，而是一条水平有很大波动的曲线，说明没有找出在这些标签上真正有价值的人群。（要么算法有问题，要么数据不支持）

比如算法没问题，但是数据只有用户观看视频的情况，却非要分类哪些人要做不孕不育手术，这种显然不可能实现，最后得到的曲线就会是波动很大的水平曲线，没有价值。

## 17.7 人口属性定向

+ 人口属性
  + 由于监测的原因，实践中主要使用的是性别、年龄
  + 在传统广告中为人群选择的主要语言
+ 人口属性定向
  + 以性别定向为例，为二分类问题
  + 需要有一定数量的标注样本，特征则来自用户行为

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621150809456-660669884.png)

# 18. 分布式计算平台

## 18.1 离线大数据平台

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621151223360-2124314221.png)

## 18.2 Flume by cloudera

+ 高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统
  + 数据源：console、text、Thrift-RPC、tail、syslog
  + 数据目的：console、dfs、Thrift-RPC
  + syslog TCP
+ 其他产品选择
  + Scribe、Chukwa、KafKa

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621154655339-1295314864.png)

## 18.3 Redis by wmware

+ 一个KV存储系统
  + Value可以支持string、list、set、zset、Hash
  + 支持push/pop、add/remove等操作
  + 高性能，使用简单，提供多种语言API
+ 注意事项
  + 避免让批量写影响在线服务中的读性能
  + 尽量用自更新的方式减少数据输入
+ 其他产品选择：Memcached

----

一般周期性（每天or半天）大批量向Redis写数据。（写的时候注意QPS，不要影响线上的读操作）

读的时候，高并发从Redis中随机读。

# 19. 如何利用合约市场：合约广告需求方产品

## 19.1 合约市场的优缺点

+ 优点
  + 有投放量的保证，确保人群触达
  + 有时可以有竞品排他服务
  + 活动类营销可以利用CPT位置获得冲击式曝光
+ 缺点
  + 很难利用精细的用户数据
  + 溢价相对较高，媒体作弊相对容易

## 19.2 合约市场的利用与选择

+ 主要的合约广告产品
  + 综合或垂直门户的首页广告位
  + 视频网站贴片广告
  + 移动应用开屏广告
+ 应用如何选择
  + 宣传活动的品牌广告，可以选择高曝光的CPT广告
  + 日常品牌触达广告，可以结合受众购买CPM广告

## 19.3 广告监播

+ 产品目的
  + 广告主委托第三方公司，对实际发生的展示或点击数目跟进核对
  + 主要适用于按CPM结算的合约广告
  + 按CPC、CPA结算的效果广告对此需求不大
+ 难点
  + 人口属性、地域等的监测
  + 样本与总体之间的校正

---

监播一般占广告主的广告预算的1%左右。

CPM是广告主要监测媒体；CPA是媒体监测广告主；不管那种监测都需要反作弊。

## 19.4 广告安全

+ 广告投放验证（Ad verification）
  + 确认品牌的安全性，防止广告出现在对品牌有伤害的页面上。（例：优衣库出现在钓鱼岛新闻上）
  + 页面内容不符合品牌诉求，则展示与品牌无关创意
  + 与广告监播不同，重点在于阻止不恰当展示的发生
  + 可以Pre-bid进行
+ 可视性（Viewability）验证
  + 验证广告展示的曝光程度
  + 判断浏览器是否对广告创意发生了渲染过程

# 20. 精细数据变现-竞价广告

## 20.1 市场经济的规则：机制设计问题

合约广告可以理解为计划经济，竞价广告可以理解为市场经济

## 20.2 竞价交易问题

如何描述竞价市场，可以使用位置拍卖模型来描述竞价市场。

竞价市场中，谁出的价格高，谁就获得更好的排名。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621164251442-648564086.png)

达到对称纳什均衡，简单说就是，如果广告主抬高价格结果ROI降低，那么就不会继续抬高价格；同理如果降低报价，结果ROI降低，那么也不会继续降低价格。

## 20.3 广义第二高价和VCG

+ 广义第二高价（Generalized second pricing）机制
  + 与VCG机制相比，会收取广告主更多的费用
  + 整体市场不是truth-telling的
  + 简单易行，为在线广告系统广告采用
  + CPM情形下：公示见下图
  + CPC情形下：公示见下图
+ VCG（Vickrey-Clarke-Groves）机制
  + 某对象的收费等于给他人带来的价值损害
  + 整体市场是truth-telling的

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621164910566-1533291670.png)

----

假如广告位只有一个，那么出价最高的就获得广告位，第二高价（假设3元）的就失去广告位投放机会。

第二高价，也就是第一名（假设5元）最后按照第二名的价格（3元）收费。

因为第一名此时可能会想如果还是5元，那么我自己调成4元如果还是第一，就可以花更少的钱排在第一了。ROI也就提高了。

**第一名的情况下没有达到纳什均衡状态**（当第一名价格最后调整至比第二名稍微多一点的时候，就达到了）。

<u>这时候，如果我们直接告知广告主，我们最后按照第二名报价收费，那么他就没有动力一直往下调低价格，甚至可能往上继续报价（为了稳住第一名的位置）。（博弈论）</u>

这时候如果有新的广告主加入，至少要出价5.1才能竞争广告位。

<u>这样子整体大家频繁调整出价的动力小了，整个系统稳定，宏观上广告市场整体收入多了，微观上当前这次是收入少了。</u>

+ **广义第二高价指的是第二高价在多个slot（比如：广告位）情况下的推广。**

广义第二高价很简单，但不是最优策略。市场最稳定的情况，最优策略，是VCG。

第一名把第二名挤下去，第二名把第三名挤下去，上面几名的收费就是等同于下面几名价值损害的量。

+ **VCG的收费一定 小于等于 广义第二高价的收费**。（VCG微观上收费更少，宏观上更为稳定）

+ 展示广告，就一个位置的竞价情况，不存在广义第二高价的概念（只有第二高价的概念）。
+ 在只有一个广告位，即s=1的情况下，VCG的结果和第二高价的结果是一致的，VCG退化成第二高价。
+ **第二高价、VCG是一种最优策略，但是广义第二高价不是最优策略**。

VCG不太需要有推荐出价，VCG，每个广告主不需要管市场情况，只需要一次广告植入对自己的价值即可。知道这个就是最优策略。理论上不需要推荐出价，有的话也只是引导用户往自己需要的方向走。

## 20.4 市场保留价和价格挤压

+ 市场保留价（Market Reserve Price，MRP）
  + 即"底价"，出价高于MRP才能参与竞价
  + 计费如果小于底价，按底价计费
  + 可以根据不同竞价标的设置不同的底价
+ 价格挤压
  + `γ = μ * ν`	=>	 `γ = μ^κ * ν`
  + κ为整数：当其充分大时，只根据点击率排序；当其接近0时，只根据点击单价排序

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621201215346-209561820.png)

+ 当κ很大时，那么广告基本只按照点击率排序，这时候广告主就会想办法提高广告质量；

+ 当κ很小时，那么广告基本只按照出价排名，土豪多出钱就能让广告排名靠前

通过调节κ，就能够调整不同的市场导向。

---

比如：

+ 当搜索引擎当季度收入达不到预期水平，那么就可以适当降低κ值，刺激广告主出价，短期内收入就会提升。（效果立竿见影）负面作用就是广告质量下降，这种策略不能长期使用。

+ 如果收入非常可观，就调高κ，刺激大家提高广告质量。

κ一般不会透露给需求方。

## 20.5 整体计价过程

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621203828462-202269094.png)

## 20.6 GSP广告竞价示例

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621204033928-490250962.png)

+ **目前市面上的所有程序化广告都是暗拍（也就是查不到市场价，不像股票那样透明。广告主只能根据自己的情况出价）**。

第一家采用VCG的是facebook。（当事人也就是单纯尝试，但是目前看来很成功）

+ **只有多个slot的时候才有VCG的概念，单个slot的情况VCG退化成第二高价**。

# 21. 最赚钱的广告产品：搜索广告

## 21.1 搜索广告基本产品形式

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621211353147-40519776.png)

**搜索广告才是原生广告中最重要的初级产品。**

## 21.2 搜索广告产品新形式

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621211932574-935782796.png)

北区必须保证结果的强相关性，东区是余光看到的东西，可以是弱相关的广告。

## 21.3 移动搜索广告

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621212231007-472213654.png)

最左边那张图，没有东区、南区，所以广告相关性要求更高。

## 21.4 搜索广告产品策略

+ 搜索广告决策过程：
  1. 查询扩展
  2. 检索
  3. 排序（根据eCPM排序。只要是排序，都是根据eCPM排序）
  4. 放置
  5. 定价
+ 关键产品策略：
  + 查询扩展、广告排序、广告放置

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210621212515924-405114206.png)

## 21.5 搜索广告计算概貌

+ 优化目标：eCPM（搜索广告中的eCPM计算公式如下图）
+ 关键特点：
  + 搜索广告的变现能力即eCPM远高于一般显示广告
  + 搜索广告的受众定向标签，即是上下文的搜索查询
  + 搜索广告样式与自然结果的展示形式非常接近，有原生广告的意味
  + 从搜索广告发展起来的竞价交易模式，已经逐渐发展成为互联网广告最主流的交易模式

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622101220370-48969855.png)

公式中：μ表示广告的点击率；α指的是广告；c表示广告的关键词；bid指的是出价；

## 21.6 搜索广告系统架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622101922587-236770385.png)

## 21.7 查询扩展主要模式

+ 精确匹配
  + 英语培训	=>	{英语培训，培训英语}
+ 短语匹配
  + 英语培训	=>	{英语培训暑期班，哪个英语培训机构好，英语的培训，英语相关培训，培训英语，英语培训，...}等
+ 广泛匹配
  + 英语培训	=>	{外语学习班，四级证书，...}
+ 否定匹配

否定匹配和广泛匹配结合使用，广泛匹配可以使用深度学习、协同过滤等方式实现。而否定匹配，相当于把一些词加入黑名单，比如可能认为“四级证书”和“英语培训”的关联不大，那么就可以把“四级证书”加入黑名单。

---

查询扩展影响整个搜索广告的效果和花费，是最重要的一个环节。

## 21.8 查询扩展主要方法

+ 基于推荐的方法
  + 在{session，query}矩阵上通过推荐技术来产生相关的关键词
  + 利用的是搜索的日志数据
+ 基于主题模型的方法
  + 根据文档主题模型，对某个查询拓展出主题相似的其他查询
  + 利用的是一般的文档数据
+ 基于历史效果的方法（这种其他方法也算不出来）
  + 记录某些对特定广告主eCPM较高的关键词
  + 利用广告本身的历史eCPM数据

## 21.9 广告位智能放置

+ 广告放置（Ad Placement）问题

  + 广告候选完成排序以后，需要分别确定北区和东区的广告条款

+ 用户体验指标

  + 北区广告的平均条数，即North Foot Print（NFP）或Average Serving Number（ASN）

    *一般会要求北区最多放X个（4），平均不能超过Y个（1.5）；东区最多放Z个（8），平均不能超过...*

+ 广告放置策略优化

  公式见下图

  *一般会要求进入北区的广告质量和相关性足够高、收益需要足够好，东区门槛低一点（弱相关区域）*

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622103349323-287292459.png)

公式中：

n<sub>i</sub>是每次广告展示中北区的广告条数；

C是要求的北区广告平均条数（有这种要求，主要是为了验证算法是否真正优化，而不是单纯靠提高平均广告条数来提高收入）；

<u>广告投放就会有一些个性化因素。如果当前用户对广告敏感，经常屏蔽广告，那么就少推送广告给他们；如果当前用户对广告不敏感，难以分辨广告和真实产品，那么就多向他们推广告</u>。这样整体广告投放量有保证，整体的用户体验也不会有太大波动。

+ **好蒙的就多放，不好蒙的就少放**（广告）

## 21.10 Google AdWords

+ 产品概况：
  + Google推出的关键词竞价广告产品
+ 其他点评：
  + 最早按CPM售卖，销售不理想
  + 后来采用了Overture的CPC售卖，并创造性地引入点击率概念表达广告相关性，取得了非常高的营收
  + 2013年营收374亿美元

## 21.11淘宝直通车

+ 产品概况：
  + 淘宝专门服务于卖家的广告产品，在搜索结果等页面上展示竞价广告
+ 其他点评：
  + 按CPC售卖，同样是按照eCPM排名
  + 广告主集中在电商行业，同时用户意图比通用搜索引擎更强烈
  + 与广告主是共生关系

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622105750905-1560850198.png)

只有东区、南区广告。

只服务淘宝内部商家用户。

# 22. 剩余流量变现产品：竞价广告网络

## 22.1 竞价广告网络产品原理

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622155947711-1933600070.png)

一般情况下，商品售卖30-40%差不多了，整体收入最优。如果商品售卖过多，说明定价可能太低，抬高售价降低销售量反而能够提高整体收入。

剩下的没有卖出的，即剩余流量，接入竞价广告网络中变现。

## 22.2 广告网络产品示例

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622160757588-23507441.png)

上图这种广告位投放方式，很可能引起用户反感，用户量流失。这样急于广告变现，最后可能短期增加了广告收入，但是却流失用户，长远看的话得不偿失。

## 22.3 广告网络产品策略

+ 广告网络展示决策过程：如下图所示
+ 关键产品策略：
  + 广告检索、广告排序

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622161221659-427045554.png)

## 22.4 广告网络计算概貌

+ 优化目标：如下图

  比起搜索广告计算，多了u参数（用户），u可能比c重要，根据用户历史行为猜测用户的需求，根据用户u做决策。

+ 关键特点：

  + 竞价方式不向广告主做量的约定，而是根据变现能力，即eCPM，来决定每次展示分配给哪个广告主。
  + 按人群售卖，淡化媒体和广告位的概念
  + 无需再满足广告主品牌独占的需求
  + 采用分成结算，运营方的现金流状况大为改善

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622161431902-565424211.png)

## 22.5 广告网络系统架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622161914727-610286520.png)

## 22.6 facebook audience network

+ 移动应用首选的变现方式
+ 对无FB帐号的用户不出广告oCPM/CPA的售卖方式
+ 目前供给和需求端都没有程序化接口

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622162234675-438462426.png)

# 23. 与搜索技术的不同：广告检索技术

## 23.1 Lucene

+ 开源的全文检索引擎
  + 包括Index和Retrieval模块
  + 提供了简单易用的API，可以快速实现大量文档的检索
  + 采用分块索引提升Index响应速度
  + 实现了布尔查询、模糊查询等
+ 不支持相关性检索
+ 其他产品选择：Elastic Search

现在的发展趋势是语义检索。

## 23.2 布尔表达式检索

+ 广告投放条件的过滤可以视为布尔表达式检索问题
+ 布尔表达式检索的一些概念
+ 基本思想

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622163104221-1647058098.png)

## 23.3 布尔表达式检索-index示例

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622163513540-1346195870.png)

## 23.4 相关性检索

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622163602134-1098307217.png)

广告的检索和搜索检索不一样，一般搜索检索就2～3个词左右。而广告检索可能需要数十个关键词用于检索。

一般广告检索中的词，不直接用or或来表示，而是用should。即检索的词最好出现，出现检索词越多分值越高。

传统搜索只需要包含关系，与and和或or。而广告搜索需要讲求相关性。

+ 一般相关性越高的，（搜索结果对应的）点击率也越高

## 23.5 Weight-And(WAND)检索算法

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622164339626-907266769.png)

## 23.6 最近邻检索

（向量空间的）语义检索，与前面的相关性检索不同。不把检索视为倒排索引问题。

+ 当把广告与用户向量化后，检索这个向量空间里最相关的K篇文档等价于计算向量距离并取K近邻的问题

+ 局部敏感哈希（LSH）

  简言之就是两个点如果足够近，那么局部敏感哈希值就可能是一样的。

  随机投影，一般选多个平面去计算。

+ 层次k均值树（HKM）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622164545840-1115338622.png)

## 23.7 回顾：Word2Vec

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622194619374-1510277423.png)

w对应语句中的一个词。每个词对应一个矢量，这个矢量就是需要优化的参数。

## 23.8 语义检索

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622194933866-1012735396.png)

---

+ 需要记住一个思想：尽量把排序层的一些操作尽量在检索层实现，不让好的候选项被遗漏。

# 24. 让系统更快地学习：短时数据统计与反馈

## 24.1 短时用户行为反馈

+ 短时用户行为
  + 狭义：用户在一个session内的行为
  + 广义：用户在短时间（一般为一到两天）内的行为
+ 短时用户行为反馈
  + 短时受众定向：根据短时行为为用户打上的标签
  + 短时点击反馈：根据短时广告交互计算的动态特征
+ 短时用户行为计算
  + 需要准实时（分钟级）对用户行为进行加工，不适合在Hadoop上进行
  + 可以利用流式计算（stream computing）平台，如S4，Storm等

## 24.2 流式计算平台-Storm

+ 大规模实时数据处理框架，自动完成数据分发和可靠性管理，开发者只需要关注处理逻辑。数据流基本在网络和内存进行。
+ 计算逻辑类似Map/Reduce，区别在**调度数据而非调度计算**

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622200823101-1385601518.png)

hadoop着重调度计算，可以进行大规模计算。

storm着重调度数据，不适合执行大规模计算。

## 24.3 在线流计算平台架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622201232570-105505648.png)

## 24.4 Thrift by facebook

+ 跨语言服务间通信
  + 不同的开源工具合适的、或不同程序员擅长的编程语言不同
  + 希望不用实现底层通信细节，专注于业务逻辑
+ Thrift
  + 支持多种语言间的跨进程、跨机器通信
  + 用Thrift IDL定义通信接口
  + 某个接口版本更新后可以兼容旧的服务
+ 其他开源产品：ProtoBuf

## 24.5 kafka by Linkedin

+ 分布式消息系统，数据消费方支持pull模式
+ O(1)复杂度的持久化和很高的吞吐率
+ 用Zookeeper来管理brokers

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622201551163-1648683036.png)

## 24.6 Apache Storm by twitter

+ 大规模实时数据处理框架，自动完成数据分发和可靠性管理，开发者只要关注处理逻辑

+ "Storm on YARN"可以与Hadoop共享计算资源
+ 其他产品选择
  + S4，PUMA，Spark Streaming

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622201714978-371212102.png)

# 25. 用算法优化收入：点击率预测

## 25.1 点击率预测问题

+ 问题关键
  + 新广告的cold-start（冷启动）
  + 捕获点击率的动态特性

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622202219201-79144814.png)

## 25.2 逻辑回归(Logistic Regression)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210622202648503-1560312215.png)

广义线性模型

**讲师建议建立复杂模型前，先建立逻辑回归模型（简单模型），这样之后对比效果，才方便看出复杂模型的效果是否好。**

在计算广告里最重要的就是根据eCPM排序，eCPM=点击率\*点击价值。
**在CPC市场中，点击价值是客户上报的已知量，此时估计eCPM的问题转化为点击率预估问题。**

## 25.3 动态特征-多层次点击反馈

+ 在标签组合维度上聚合点击反馈统计作为 CTR预测的特征
+ 优势
  + 工程架构扩展性强（与在线学习相比）
  + 对新（a，u，c）组合有较强back-off能力
+ 缺点
  + 在线特征的存储量大，更新要求高
+ 组合维度举例
  + cookie(u) and creative(a)
  + gender(u) and topic(c)
  + category(a) and category(u)
  + creative(a), gender(u)

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623093914238-1156768918.png)

## 25.4 归一化点击率-COEC

+ 有效展示
  + 可以通过Eye tracking测算
  + 工程上可以使用Expected Click（EC）来近似有效展示
+ EC的计算
  + 实测法：实际随机流量测算
  + Bias模型法：只使用与广告决策无关的bias特征训练的CTR模型：
+ 归一化点击率 COEC

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623094750358-2133810784.png)

---

如果一个广告位的有效展示是另一个广告的两倍，那么假设它们广告展示质量类似，那么就可以认为第一个广告的点击量是第二个广告的两倍。

COEC可信度更高

## 25.5 在线广告常见bias特征

+ 广告位位置
  + 搜索广告：North 1，North 2，...，East 1，East 2，...
  + 显示广告：相对页面的（x，y）
+ 广告位尺寸
+ 广告位类型
  + 门户首页，频道首页，内容页，客户端，...
+ 操作系统和浏览器
+ 广告投放延迟
+ 日期和时间

## 25.6 消除偏差的点击率模型训练过程

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623100352383-358999026.png)

## 25.7 点击反馈的平滑

+ 问题：在数据稀疏的情况下较稳健地估计CTR或COEC
+ 经验贝叶斯方案

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623100635132-1556625280.png)

## 25.6 经验贝叶斯解

+ 点击率的平滑通常在每个维度组合上分别进行
+ 物理意义
  + 数据不足时，更依赖于相应维度组合的点击率先验值

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623100841318-2026604723.png)

## 25.7 点击率模型的校准

+ 正负样本不均衡带来的估计误差
+ 误差对一些广义线性模型都存在，包括LR
+ 可以通过数据计算并校准

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623101038654-1433161092.png)

## 25.8 FM点击率模型

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623101539358-134598894.png)

## 25.9 深度学习点击率模型

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623102011271-1829466372.png)

需要有足够的数据量

## 25.10 评测指标-PR曲线与ROC曲线

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623102323624-491578956.png)

最常用的是ROC曲线。

PR曲线左边越高越好。

# 26 未知领域的冷启动：探索与利用

## 26.1 探索与利用(E&E)问题与思路

+ 问题
  + 为长尾的(a,u,c)创造展示机会以积累统计量，从而更准确估计CTR
  + 提升整体的广告收入，即需要严格控制探索的量和有效性
+ 方法思路
  + 通常描述为Multi-arm Bandit（MAB）问题
    + 有限个arms（或称收益提供者）a，每个有确定有限的期望收益
    + 在每个时刻t，我们必须从arms中选择一个，最终目标是优化整体收益
  + 基本方法为ε-greedy：将ε比例的小部分流量用于随机探索
+ 广告问题中的主要挑战
  + 海量的组合空间需要被探索
  + 各个arm的期望收益是动态变化的

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623103101212-471006713.png)

---

广告系统，最后一般5%～10%随机流量投放。

# 27. 如何利用竞价市场：竞价广告需求方产品

## 27.1 搜索引擎营销（SEM）

+ 产品目标
  + 帮助搜索广告主管理预算，优化商业目标
  + 主要商业目标：花费、ROI
+ 主要功能
  + 基础功能：管理campaign和关键词，实现便捷操作
  + 高级功能：拓词、自动价格优化

## 27.2 EfficientFrontier

+ 核心业务：
  + 为搜索广告主提供大量关键词情形下的ROI优化服务
  + 核心技术为Portfolio Optimization
+ 其他点评：
  + 核心竞争力除了算法还来自于长时间数据积累
  + 被Adobe收购与Omniture数据结合，现改名Adobe Adlens

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623153700085-58854941.png)

## 27.3 非RTB流量的ROI优化

+ 目标：
  + 给定总预算，在多广告网络中采买并优化ROI（例：SEM）
+ 关键问题：
  + 在合适的流量segment上投放广告
    + SEM中的选词，显示广告网络中的标签组合选择
+ 在每个投放上合理地出价以优化ROI
  + 于RTB不同，采用方无法控制每次展示的出价
  + u，c的取值未知，需要在各流量分割上估计其分布并合理出价

## 27.4 广告购买平台（Trading Desk）

+ 产品目标：
  + 帮助广告主按人群进行跨媒体和广告网络采买
+ 关键特征：
  + 连接到不同广告网络和DSP，提供统一市场
  + 非实时竞价投放的ROI优化能力
  + 广告代理公司大多有此概念性产品

---

在国内市场中，这个就是一个概念，并不是一个产品。

# 28. 多方数据变现-程序化交易

## 28.1 与证劵类似的交易：程序化交易若干模式

### 28.1.1 IAB总结的程序化相关交易方式

<table>
	<tr>
	   <th></th>
	   <th>库存类型</th>
	   <th>价格模式</th>
	   <th>参与方式</th>
	   <th>市场术语举例</th>
	</tr>
	<tr>
	   <td>担保投送优化</br>(automated guaranteed)</td>
	   <td>预留</td>
	   <td>定价</td>
	   <td>一对一</td>
	   <td><b>programmatic direct，</b></br>programmatic premium</td>
	</tr>
	<tr>
	   <td>非预留定价交易</br>(unreserved fixed rate)</td>
	   <td>非预留</td>
	   <td>定价</td>
	   <td>一对一</td>
	   <td><b>preferred deals</b>，private access，</br>first right of refusal</td>
	</tr>
	<tr>
	   <td>邀请制竞价交易</br>(invitation-only auction)</td>
	   <td>非预留</td>
	   <td>竞价</td>
	   <td>一对少量</td>
	   <td><b>private marketplace</b>，private auction，</br>closed auction，private access</td>
	</tr>
	<tr>
	   <td>公开竞价交易</br>(open Auction)</td>
	   <td>非预留</td>
	   <td>竞价</td>
	   <td>一对多个</td>
	   <td><b>real-time bidding(RTB)</b>，</br>open exchange，open marketplace</td>
	</tr>
</table>

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623155442553-754441489.png)

从上到下重要性递增。

## 28.2 实时竞价过程示意

+ Ad Exchange方实现的部分称为RTBD（RTB for Demmand）
+ 在DSP方实现的部分，我们称为RTBS（RTB for Supply）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623161750697-842531318.png)

---

实时竞价，是程序化交易的典型代表模式

用户访问一个媒体网站，原本的操作是媒体网站请求自己的服务器，服务器返回一个广告，自产自销。

现在改成，媒体网站请求广告交易平台ADX，ADX本身没有广告，实时把请求转发到上游（需求方一般叫上游）的DSP，DSP收到请求后进行计算（该出什么广告，应该出多少钱），将计算结果返回给ADX（返回的价格是CPM价），ADX进行简单的比价，发现DSP1胜出，然后就把这次广告展示的机会交给DSP1，DSP1将广告投放到媒体网站。

## 28.3 实时竞价特点

+ 每次展示都有Ad Exchange服务器与多个DSP服务器的参与，这使得服务器与带宽成本大大增加；
+ 在询价过程中，Ad Exchange要等待一个约定好的时间片（一般情况下为100ms），这使得用户看到的广告延迟增加，对CTR有负面影响；
+ 原理上DSP可以以极低的出价参与竞价，这样虽不能获得流量，却可以低成本得到在媒体网站上的用户行为数据，这里存在着潜在的信息泄漏风险。

## 28.4 优选（Preferred Deal）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623163124842-1977245355.png)

可以视为实时竞价广告在只有一个广告主的特例，只有一个DSP，没有必要竞价，直接就是定价交易。因为需求方要选量，这个定价也会比正常的价格要高一点。

## 28.5 私有市场（PMP）

+ 媒体为了保证广告主的质量，希望将拍卖限制在一些被邀请需求方的小范围内。这种程序化交易，叫做私有市场（Private Marketplace，PMP）
+ 兼顾了优选与实时竞价的好处
  + 广告主的质量可以由少量被邀请需求方很好地控制，这有利于确保媒体的价值不受伤害；
  + 在需求方之间保留了竞价关系，有利于提升媒体的变现能力
+ 交易接口的形式与一般RTB一致

## 28.6 程序化直投（PDB）

+ DSP根据广告主需求，进行媒体采买，并且将采买的广告资源二次分配给广告主的不同子品牌或产品，这叫程序化直投（Programmatic Direct Buy，PDP）
+ 本质上是一种GD或Network的投放方式
  + 如果子品牌有保量需求，是GD市场
  + 如果子品牌没有保量需求，可以用竞价广告网络的方式运营
+ 产品形式和前述的RTB/PMP完全不同，需要单独的广告投放系统，或者是自建一个专用ADX，用DSP接入。

## 28.7 美国程序化交易市场趋势

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623164739619-127344242.png)

---

合约广告和竞价广告是对立的。竞价广告又分为封闭的竞价广告和程序化广告。

PBP是合约广告和程序化广告的融合。

facebook大多是封闭式的network，没有程序化的部分。

## 28.8 在线广告交易方式

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623165102124-1620543961.png)

## 28.9 在线广告市场产品交互关系

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623165140572-1536622280.png)

#29. “证劵交易所”：广告交易平台

## 29.1 广告交易平台（ADX）

+ 关键特征：
  + 用实时竞价（RTB）方式连接广告和（上下文，用户）
  + 按照展示上的竞价收取广告主费用
+ 类比：
  + 实时竞价 <=> 股票实时交易
  + 广告交易市场 <=> 证劵交易所
  + 需求方平台 <=> 劵商

## 29.2 广告交易平台特点

+ 优化目标：公式如下图
+ 关键特点：
  + 竞价方式不向广告主做量的约定，而是根据变现能力，即eCPM，来决定每次展示分配给哪个广告主。
  + 按人群售卖，淡化媒体和广告位的概念
  + 无需再满足广告主品牌独占的要求
  + 采用分成结算，运营方的现金流状况大为改善
  
![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623165705593-1964214665.png)
  
## 29.3 ADX系统架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623170026985-1987298449.png)

## 29.4 ADX主要技术点

+ 由于实时竞价的功能需求，广告交易市场解决供给方和需求方用户身份对应的问题，在web的广告环境下，这需要用到**cookie-mapping**的技术
+ 实践中当考虑到带宽和服务成本带来的约束时，希望用更少的询价请求完成尽可能高效的变现，在这种情况下，公式的优化问题会有所变化，这一问题称为**询价优化**。

## 29.5 两域名Cookie Mapping（例：媒体与DMP）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623170344736-1635191928.png)

## 29.6 三域名Cookie Mapping（例：ADX与DSP）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623170549359-643264788.png)

## 29.7 询价优化（Call Out Optimization）

+ 问题：
  + 在带宽和服务成本的约束下获得更高的eCPM

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623170817940-290550583.png)

# 30. "券商下单系统"：需求方平台

## 30.1 定制化用户标签

+ 定制化标签：
  + 根据广告主需求加工的标签体系
  + 往往要用到第一方数据
+ 定制化标签典型方式：
  + 网站重定向 => 个性化定向（电商标配）
  + 搜索重定向
  + 新客推荐（Look-alike）

## 30.2 重定向（Retargeting）原理

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623203812273-1654851550.png)

---

举例子，比如自己买的一个衣服，不是所谓的潮牌或一线品牌，但是正好浏览网页广告或者线下商店广告的时候看到同品牌商品，就会觉得自己购买决策正确。心理上就会认为自己购买选择正确，认为对应品牌形象是正面的。

这种效应也被称为"孕妇效应"（孕妇人群比其他人更敏感地能判断出哪些人是孕妇）。

重定向（Retargeting）可以说和DSP相伴而生，没有重定向（Retargeting）就没有今天的DSP，现在DSP不止Retargeting，但是早期Retargeting确实是DSP最成功的一种定向方式。

## 30.3 重定向分类

+ 网站重定向（Site retargeting）
  + 根据用户在广告主网站上的行为进行重定向
+ 搜索重定向（Search retargeting）
  + 根据用户与广告主相关的搜索行为进行重定向
+ 个性化重定向（Personalized retargeting）
  + 根据用户在广告主网站上关注的具体产品和购买阶段，推送商品粒度的广告，可以视为一个站外推荐引擎

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623205045486-1649935799.png)

## 30.4 新客推荐（Look-alike）

+ 问题：
  + 对于中小电商，仅对老用户定向营销远远不够
  + 对于某些类型的广告商，大多数用户无法通过重定向渠道捕捉，例如银行
新客推荐：
  + 由广告商提供一部分种子用户，DSP通过网络行为的相似性为其找到潜在用户
  + 是一种广告商自定义标签，可视为扩展重定向
  + 在同样reach水平下，效果应好于通用标签

---

讲师说，现实中很多广告公司只要说不清自己的算法怎么做的时候，就会说自己是实现的新客推荐（Look-alike），说不清自己数据来源和自己效果为什么好，往往都是作弊做好的。说不清楚就说是look-alike。

look-alike本身不是一种方法，而是一种思想方式。

## 30.5 DSP产品策略

+ DSP展示决策过程

+ 关键产品策略：
    + 点击价值估计、出价策略

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623213235752-1706459988.png)

---

微信本地广告不是DSP，是典型的Ad Network

## 30.6 invitemedia

+ 核心业务：
  + 传统业务是提供比较透明的Adx采买功能，并收取固定比例的佣金
  + 正在提供越来越深入的采买ROI优化服务
+ 其他点评：
  + 与DFA，Adx已整合，可减少ck mapping带来的损失
  + 改称doubleclick bid manager，并提供更多的优化功能

## 30.7 DSP产品特点

+ 优化目标
+ 关键特点
    + 需要支持定制化的用户划分能力
    + 由于DSP是完全面向广告主的产品，需要在量的约束下投放，这产生了对于出价策略的需求
    + 在按CPS等效果结算的DSP中，需要同时估计点击率点击价值。并且由于出价的要求，估计都要尽可能准确

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623223215353-211604590.png)

## 30.8 DSP系统架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623223553202-221940412.png)

## 30.9 Look-alike问题建模

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623224122280-728120629.png)

## 30.10 点击价值估计

+ 点击价值分解
+ 到达率：主要与媒体匹配程度、广告主网页加载速度相关
+ 转化率：行为稀疏、定义与广告主类型密切相关

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623224444897-952229975.png)

---

大多数情况不会建立模型去预估点击价值（除非有特别大的数量级，比如大电商平台）

大体上说，DSP要估计点击率和点击单价，想乘后得到eCPM去出价。

实际分工中，一般技术实现点击率模型用于估计点击率，运营人员负责预估点击单价，系统还是一个CPC系统，系统相乘得到eCPM。

## 30.11 从电商角度看推荐

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623225057734-749103949.png)

---

基本所有的互联网服务都在电商化。

从技术角度，出现先后为：站内推荐、站外推荐、新客推荐
从电商角度（客户拉拢的过程）则相反：新课推荐、站外推荐、站内推荐

## 30.12 DSP出价策略

+ 如果没有预算的限制：只要按照eCPM水平出价，就可以保证在第二高价的情况下每次展示都有利润。
+ 在有预算约束的情况下，我们需要估计eCPM以及当前展示的市场价格，并在尽可能将出价集中在那些利润较高的展示上。

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210623225536448-1981854899.png)

蓝线指的是市场价market price。图中最右浅灰色时间段市场价低，利润（出价-市场价）最高。（出价一般就是和eCPM相近）

## 30.13 criteo

+ 核心功能：
    + 基于站外推荐的个性化重定向系统
    + 动态创意技术
    + 与广告主商品库的准实时feed接口
+ 其他点评：
    + 兼用RTB和优选方式购买流量
    + 在广告主端完全采用CPC结算方式
    + **不会将cross-site数据用于推荐**

# 31. 多渠道库存管理：供给方平台

## 31.1 网络优化(Network Optimization)与SSP

+ 网络优化问题：
    + 接入多个Ad Network，动态决定某次展示分配给谁
    + 相当于DSP不主动出价的交易平台
+ 供给方平台（Supply Side Platform，SSP）
    + 综合利用各种需求方预算，在不伤害媒体品牌属性的前提下优化收入
    + 也会提供通过RTB对接DSP的接口
    + 与Ad Exchange的边界越来越模糊

## 31.2 SSP产品策略

+ SSP展示决策过程-动态分配（Dynamic Allocation）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624135428792-693660331.png)

## 31.3 Header Bidding

+ 什么是Header Bidding？
    + 媒体绕开Google、Mopub等ADX，通过**客户端聚合JS代码或SDK**的方式，直接向其他ADN或ADX发起询价。
+ 商业本质
    + 打破Google、Mopub对于市场的垄断
    + 媒体欢迎的原因主要是更低的费率、更公平的竞价
+ 产品问题
    + 聚合多家JS或SDK带来巨大的延时
    + 不如server端RTB方式灵活，但避免了cookie mapping的损失

## 31.4 Header Bidding决策过程

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624140147264-1205172213.png)

---

server to server会更合理。

但是这种模式误打误撞，媒体赚到更多的钱，广告主绕开平台分配策略，直接拿到媒体流量，双赢。

外国移动端也有Header Bidding（国内技术上可以做，但是产品上意义不大。市场情况不适合）

## 31.5 Admeld

+ 核心功能：
    + Yield Optimizer，统一优化premium sales，network和RTB流量
    + 以优化媒体利益为目标
+ 其他点评：
    + 起主要作用的部分除了RTB，还有多network接入时eCPM的估计和选择
    + 会从DMP购买标签数据用于优化广告效果
    + 主要进行广告位和时间维度上eCPM估计和流量切分

## 31.6 mopub

+ 核心功能：
    + 领先的移动Mediation平台，通过SDK对接媒体，需求方聚合FAN、Admob等多家SDK
    + 有自己的Marketplace即RTB市场
    + 提供媒体上传自己签约的广告合同功能
+ 其他点评：
    + 收取30～40%的费用，成为媒体直接对接其他需求方的动力
    + Network Optimization功能不太重要

# 32. 数据资产金融化：数据管理产品

## 32.1 三方数据的概念

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624142820240-1421235305.png)

## 32.2 数据的价值与地位

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624142951027-1836696783.png)

## 32.3 第三方DMP

+ 目的:
    + 聚合多种原始行为数据，加工成统一标签后，在公开市场上售卖
    + 聚合多种加工后标签数据，在公开市场上售卖
+ 主要特征：
    + 主要负责第三方数据的收集、加工和流转，不一定直接从事广告交易
    + 多于广告交易平台、SSP等合作进行数据变现

## 32.4 第三方DMP商业模式

+ DMP从多个DP那里收集原始数据，按照自己的逻辑加工成用户标签，并向DSP出售标签数据收入
+ DMP获得的收入再按照一定的比例分成给DP

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624143339571-545701936.png)

## 32.5 第一方DMP

+ 目的：
    + 为网站提供第一方数据加工和应用能力
    + 结合公开市场第三方数据，加工跨媒体用户标签，支持网站业务运营和广告投放
+ 主要特征：
    + 第一方用户定制化划分能力
    + 统一的对外数据接口

## 32.6 第一方DMP商业模式

+ DMP应数据源（Data Provider，DP）的要求，收集第一方数据，并加工成第一方需要的用户标签
+ DP可以根据这些用户标签进行站内的运营，也可以用来指导DSP进行广告投放
+ DMP会向DP收取费用，但是绝对不会把数据二次变现

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624143919754-1226797130.png)

## 32.7 Audience Science

+ 核心业务：
    + 主要提供面向publisher的数据加工服务
    + 直接运营ad network进行数据变现
+ 其他点评：
    + 较早提出受众定向（audience targeting）的概念
    + 数据标签不像bluekai那样在市场上公开出售
    + 使用标签创造的营收按照一定比例跟publisher分成

---

Audience Science是第一方DMP；bluekai是第三方DMP    

## 32.8 为什么数据不能共享？

+ 疑问：数据交换似乎在发生啊？
    + 那往往是因为有更高层次的交换，即投资关系
+ 为什么大公司不把数据共享出来？
    + 你见过大公司把钱共享出来么？
    + 短时的贴补性共享是可行的
+ 政府数据是可以共享的，这本质上是转移支付

## 32.9 数据交易该怎么做？

+ 数据传输附着在实时竞价过程，无额外开销
+ 需求方可以自由地选择需要的部分人群数据，**并且按照实际的广告展示付费**

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624150330822-2004976689.png)

---

+ DSP可以部分选购，比如DMP售卖全国统计的性别数据，但是DSP只要购买部分，则ADX只抽取部分提供给DSP，降低了DSP的成本，也使得DMP的数据能合理盈利
+ ADX在中间天然地起到数据审批的作用，谁用多少数据，产生了多少次交易，它作为中继方都能得知。

## 32.10 如何给数据定价？

+ 市场化的定价方式是唯一的选择
+ 目前数据的价值是被低估的
    + 上页的交易方式并为限制数据供给次数
    + 这间接抬高了流量价格，而低估了数据价格
+ 能够采用竞价的交易方式？
    + 不限量供应的商品，是无法竞价的
    + **数据的限量供应怎么做？**

## 32.11 数据管理平台系统架构

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624152533708-29619294.png)

# 33. 对抗数据的黑客：隐私保护和数据安全

## 33.1 数据隐私的初步认识

+ 隐私安全基本原则
    + A29：欧盟负责隐私保护条例制定的委员会
    + A29原则：
        + Personal Identifiable Information（PII）不能使用
        + 用户可以要求系统停止记录和使用自己的行为数据
        + 不能长期保存和使用用户的行为数据
+ Quasi-identifier与K-anonymity
    + Quasi-identifier：朝阳区，35岁，在360上班
    + K-anonymity：北京市，30-40岁，互联网行业

## 33.2 互联网行为数据隐私问题

+ 稀疏行为数据的新挑战
    + 从一个人观影或购物记录，能否反推他是谁？
    + 实际案例：Netflix推荐大赛，有人从数据集里发现了自己的同事是同性恋
    + 理论研究：Robust De-anonymization of Large Spare Datasets
+ 深度个性化系统也有隐私安全风险
    + 相关研究课题是差分隐私（Different Privacy）
+ 隐私是大数据头上的达摩克利斯之剑    

## 33.3 差分隐私（Differential Privacy）
+ 差分隐私的问题
    + 最大化个性化系统准确率的同时，最小化隐私泄露风险
    + 需要对原始数据做一定的**随机化**处理
+ 部分成果已经使用在IOS10当中

## 33.4 需求方数据安全问题

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624154112488-610529409.png)

---

广告平台，给互为竞品的两方的用户投放广告，整体广告市场价提高，广告平台盈利了，但是这两个需求方实际都亏损了（广告效果变差）

# 34. 永无止境的博弈：流量保护和反作弊

## 34.1 作弊的分类

+ CPM/CPC作弊 <=> CPA/CPS作弊
+ 虚假流量（NHT） <=> 流量归因
+ 机器作弊 <=> 人工作弊

## 34.2 CPM/CPC广告监测

1. 广告主与媒体签订广告合同，约定结算方式
2. 第三方监测在广告展示环节添加检测代码/SDK，随着广告一齐到达用户端
3. 媒体展示广告，用户看到广告创意
4. 用户产生广告交互行为的数据被发送到第三方，第三方进行统计
5. 第三方将统计数据交给广告主，广告主据此与媒体结算

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624160809504-562925639.png)

## 34.3 广告监测代码

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624161111187-989473348.png)

## 34.4 CPA/CPS广告归因

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624161205118-387855989.png)

## 34.5 刷检测代码作弊

+ 直接刷代码
+ 服务器刷代码
+ 客户端刷代码

## 34.6 iFrame虚假展示作弊

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624161557931-162298558.png)

## 34.7 诱骗用户点击

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624161835458-721397867.png)

## 34.8 点击热力图检测作弊

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624161926928-1911253624.png)

## 34.9 作弊中如何处理用户ID

+ 频繁更换用户ID
+ Cloaking

---

Cloaking，收集所有来自目标公司的IP地址，如果请求来自这些IP，就正常搞；不是这些IP地址的，就乱搞。这样可以延缓被公司发现的时间，这段时间就可以赚到很多不道德的钱了。（对付大公司平台的常见手段）

## 34.10 运营商弹窗

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624162337924-1400724000.png)

---

虽然是真实有效的流量，但是也归为作弊。因为流量来源合法性存疑。通过DPR的手段，插包进去，改变用户看到的东西。图中左边的例子，电视运营商作弊，地方台在中央台下方插入文字链广告。

右图一个流量球，则是用户点开后显示自己剩余流量，同时下面可以插播广告。

如果是效果类广告主（游戏、电商），用这种方式也无妨（反正媒体这么做是它们的问题），但是如果是品牌广告主一般不会用，这类流量有损形象。

## 34.11 CPS作弊手段

+ 运营商落地页劫持
    + 比如正常访问某个网址，结果被运营商最后多加了一些参数，看上去就变成了从别的页面跳转的（这样别的页面就有广告收入了）
+ Cookie Stuffing
    + 在CPS联盟机制下，只要给用户打上标识媒体来源的Cookie，该用户的购买行为就会归到该媒体
    + 基本原理是在用户浏览器上悄悄对推广链接发起HTTP请求，在用户不点击广告的情况下打上媒体的Cookie

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624163134105-22692629.png)

---

有些渠道（CPS、CPA）的retarget效果特别好时，就要留意一下，可能是有作弊情况

## 34.12 CPI常见作弊手段

移动应用下载市场的常见作弊手段：
+ <u>ClickSpam</u>（流量归因作弊，和前面的Cookie Stuffing一样，只要加载到广告，就自动帮你点击了，之后要是用户阴差阳错下载了app，就算广告收入了。因为全靠蒙，所以转化率低，但是后续效果好。）
+ Click injection（只在国外安卓市场才用得上）
+ Ad stacking（和ClickSpam一样的原理）
+ <u>刷机</u>（最常见，完全伪造虚假点击和虚假转化）

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624163900001-334753670.png)

--- 

刷机的转化率很高，但是后续效果很差

ClickSpam转化率极低，但是后续效果过高

+ 如果刷机和ClickSpam两者结合，可能就难以区分是否作弊行为 

**正常的广告转换，一般在未来1-2小时内就完成了，后续可能也会有，但是数量很少。尾部很多广告转换的，可能就存在作弊现象。（转换率低、尾巴大，作弊的主要特征）**

## 34.13 常见人工作弊

+ 淘宝代销
+ 羊毛党（典型的就是P2P）
+ 买栗子（谐音leads，销售线索）

---

买栗子（现实中买栗子是很常见的现象）基本是不得已而为之，就是上面给的PKI过于离谱无法实现，那就只能作弊了

# 35. 场景数据利用-原生广告

## 35.1 原生不是新问题：原生广告初级形态

### 35.1.1 搜索广告的原生性

+ 表现形式
    + 广告结果与自然结果非常接近
+ 触发原则
    + 同样根据关键词触发，与自然结果也保持一致

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624230024459-719515089.png)

### 35.1.2 信息流广告

+ 表现形式
    + 广告结果与自然结果基本一致
+ 触发原则
    + 在社交类媒体中，用户往往无明确意图，因此根据投放条件触发

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624230311424-1094492619.png)

### 35.1.3 软文

+ 表现形式
    + 与自然结果非常一致地呈现
+ 触发原则
    + 内容本身即按广告主需求生产
+ 规模化比较困难

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624230532228-1511756397.png)

--- 

软文是最彻底的原生广告，因为软文本身就是按照广告商需求来制作的。

### 35.1.4 CPS/CPA联盟（Affiliate）

+ 表现形式
    + 渠道可以灵活决定，比较容易适配环境
+ 触发原则
    + 可以完全融入到垂直内容当中
+ 平台不易控制作弊

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624230757547-1981158349.png)

---

**Ad Network广告网络和Affiliate联盟的区别：**
+ 广告网络收纳许多广告，然后给媒体出广告时，广告网络决策发送哪一个广告
+ 联盟收纳广告后，直接把广告库交由给媒体，由媒体自己决定展示哪一个广告（媒体甚至可以自己控制样式，更加灵活）

CPS/CPA联盟把创意的形式和控制权完全交由给了媒体，使得媒体可以用自己的方式去改造创意，更加灵活。

# 36.与PC有何不同：移动广告机遇与挑战

## 36.1 移动广告的特点

+ 情境广告的可能性：
    + 移动设备与PC最大的不同，是可以对用户行为模式进行全天候的检测和分析
    + 从地理位置、生活状态、需求意图等方面都可能对用户有深入的理解
+ 大量潜在的O2O广告主
    + GPS、蜂窝、wifi等多种精确定位的手段，使得基于精确地理位置的O2O广告变得可行

## 36.2 移动广告的创意形式

+ 条幅（banner）
+ 全屏
+ 应用推荐、积分墙

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624232753932-586722323.png)

## 36.3 移动广告的挑战

+ 应用生态造成的行为数据割裂
+ 许多PC时代广告主移动化程度还不够，无法充分消化广告带来的流量
+ 移动广告的产品形态需要一次革命

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210624233410599-618804522.png)

## 36.4 应用下载归因(Attribution)
+ 归因于最后一次点击，一般1～3天内有效
+ 应用下载归因原理
    + IOS：点击时向监测商发送iDFA
    + Android：利用Google Play的refer机制
    + WAP：提供点击和转化的fingerprint进行匹配
+ 主要技术提供商
    + 全球：Appsflyer，Adjust 点击、转化都收费
    + 国内：TalkingData 只有转化收费

# 37. 移动场景定向

## 37.1 什么是场景？

+ 用户当前所处的场景和状态
    + 例如：地铁上、上厕所、开会中、运动中
+ 丰富的场景是移动设备所特有的
    + 台式机：位置固定，只有极简单的场景
    + 笔记本：可以移动，但只有工作和娱乐类场景
    + 移动设备：人体器官，具有人们所有可能的场景
+ 场景是不是上下文？
    + 不是，场景是用户的状态，而非媒体的特征

## 37.2 如何检测场景？

+ 根据移动多种信息来源和传感器进行检测
+ 例：检测用户是否处于**工作状态**
    + 每天上午10点，对用户地理位置采样，如果大多数采样都在同一位置，则该位置为用户上班地点
    + 如果采样没有明显的位置规律，则用户为销售等无固定地点工作者
    + 监测到用户处于上班地点，则认为其处于工作状态
+ 注意：场景检测不需要逻辑上完全正确

# 38. 打造植入式体验：原生广告产品未来

## 38.1 原生广告平台应该是什么样的？
+ 媒体控制广告展示形式：
    + 原生广告的最重要的产品原则，是即内容与广告的展示形式要尽可能一致，而没有媒体的参与是不可能的
+ 媒体明确提供广告需求：
    + 搜索广告的效果好，因为其投放是按照内容结果的展示原则进行的
+ 广告平台提供结构化付费内容：
    + 核心的定向条件检索+eCPM排序功能仍然没变

### 38.1.1 植入式原生广告

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625002152595-1599688994.png)

我们可以很容易地从文章中提取数十个关键词，但很难总结出需求就是要在这里放置同地区的酒店广告（高层语义很难得到）。而媒体可以请说的说出用户查询类型是酒店，地点是拉萨。

### 38.1.2 表现原生

+ 情形一：广告自燃地显示在媒体内容中
    + 例：信息流、瀑布流
+ 情形二：独立广告位风格与媒体靠近
    + 例：原生化插屏

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625002611766-356516539.png)

### 38.1.3 场景原生

+ 情形一：根据App的需求提供付费内容
    + 例：电商比价
+ 情形二：根据数据来判断用户场景，进而提供相应的付费内容

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625002949491-2057039225.png)

## 38.2 原生广告方向与挑战

+ 方向：
    + 让媒体深入参与广告交易，而不是像传统广告系统那样只在平台和需求方之间交易。
    + 将数据驱动的受众定向展示广告，变成以媒体内容为导向的，不触及用户隐私的精准广告
    + 让高相关的付费内容代替广告成为媒体变现主要方式
+ 挑战：
    + 媒体参与让广告多了个自由度，运营难度增大
    + 大量分行业、结构化广告信息的建立需要时间

## 38.3 Inmobi原生广告

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625004218192-1363780696.png)    

## 38.4 facebook信息流广告

向媒体返回元素进行动态拼装

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625004334492-505947654.png)

## 38.5 vungle原生激励视频

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625004742078-570460982.png)

## 38.6 outbrain内容发现平台

+ 网站将内容以RSS feed方式提供给Outbrain并给出点击单机，Outbrain将这些付费内容在其他网站上推荐给读者
+ 推荐与广告的边界模糊化
+ 将内容也按照eCPM最大的方式排序，这一思路也可以被站内的推荐系统，即流量塑形

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625005158921-1182866290.png)

# 39. 从传播到交互：创意的优化与发展

## 39.1 创意优化

+ 品牌性创意与效果性创意
+ 在相近的广告诉求下，通过创意内容优化效果

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625005800116-2110793494.png)

## 39.2 创意优化主要思路

+ 程序化创意
    + 网站重定向广告加入广告主logo
    + 搜索重定向广告加入搜索框
    + 地域定向明示地点或本地电话
+ 充分利用点击热点图
    + 如图所示，是否创意中的关键诉求确实吸引了用户的注意？

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625005926713-1864403732.png)

## 39.3 交互化的创意发展方向

静态创意 => 动态创意(视频创意) => 交互式创意 

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625010141495-1692210254.png)

## 39.4 APPLOVIN

+ 核心业务：
    + 移动广告网络，向APP同时提供变现和推广服务
    + 主要营收来源于游戏内激励视频广告
    + 程序化业务并不发达
+ 其他点评：
    + 2016.9以14亿美金价格被中国基金收购
    + Casino游戏收入占比很高，原因不详

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625010304992-562333391.png)

## 39.5 cross x install

+ 核心业务：
    + H5 Playable Ads + DSP
    + 以游戏类CPA广告主为主
    + 关键能力是通过A/B测试调整和H5创意中的参数
+ 其他点评：
    + 为数不多的成功投放移动CPA广告的DSP

![](https://img2020.cnblogs.com/blog/1244059/202106/1244059-20210625010531161-903573487.png)

